<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Community Savings Platform</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100%;
      color: #333;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    /* Header Styles */
    .header {
      background: white;
      padding: 20px 0;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 30px;
      border-radius: 10px;
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 30px;
      flex-wrap: wrap;
      gap: 20px;
    }

    .logo {
      font-size: 28px;
      font-weight: bold;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .nav-controls {
      display: flex;
      gap: 15px;
      align-items: center;
      flex-wrap: wrap;
    }

    .language-selector {
      padding: 10px 15px;
      border: 2px solid #667eea;
      border-radius: 8px;
      background: white;
      color: #667eea;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .language-selector:hover {
      background: #667eea;
      color: white;
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 14px;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    .btn-secondary {
      background: white;
      color: #667eea;
      border: 2px solid #667eea;
    }

    .btn-secondary:hover {
      background: #667eea;
      color: white;
    }

    .btn-danger {
      background: #ef4444;
      color: white;
    }

    .btn-danger:hover {
      background: #dc2626;
    }

    .btn-success {
      background: #10b981;
      color: white;
    }

    .btn-success:hover {
      background: #059669;
    }

    /* Page Styles */
    .page {
      display: none;
      background: white;
      border-radius: 15px;
      padding: 40px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      animation: fadeIn 0.3s;
    }

    .page.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Home Page */
    .hero {
      text-align: center;
      padding: 60px 20px;
      background: linear-gradient(135deg, #667eea20 0%, #764ba220 100%);
      border-radius: 15px;
      margin-bottom: 40px;
    }

    .hero h1 {
      font-size: 48px;
      margin-bottom: 20px;
      color: #1f2937;
    }

    .hero p {
      font-size: 20px;
      color: #6b7280;
      max-width: 700px;
      margin: 0 auto 30px;
    }

    .features-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 30px;
      margin: 40px 0;
    }

    .feature-card {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      border: 2px solid #e5e7eb;
      transition: all 0.3s;
    }

    .feature-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.2);
      border-color: #667eea;
    }

    .feature-icon {
      font-size: 48px;
      margin-bottom: 20px;
    }

    .feature-card h3 {
      font-size: 24px;
      margin-bottom: 15px;
      color: #1f2937;
    }

    .feature-card p {
      color: #6b7280;
      line-height: 1.6;
    }

    /* Form Styles */
    .form-container {
      max-width: 400px;
      margin: 0 auto;
      
    }

    .form-group {
      margin-bottom: 8px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #374151;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 12px;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      font-size: 14px;
      transition: border-color 0.3s;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #667eea;
    }

    .form-group textarea {
      resize: vertical;
      min-height: 100px;
    }

    .password-toggle {
      position: relative;
    }

    .password-toggle-btn {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      cursor: pointer;
      font-size: 20px;
    }

    .error-message {
      background: #fee2e2;
      color: #dc2626;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 20px;
      border-left: 4px solid #dc2626;
    }

    .success-message {
      background: #d1fae5;
      color: #059669;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 20px;
      border-left: 4px solid #059669;
    }

    /* Dashboard Styles */
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 25px;
      margin-bottom: 40px;
    }

    .stat-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    .stat-card h3 {
      font-size: 16px;
      opacity: 0.9;
      margin-bottom: 10px;
    }

    .stat-card .stat-value {
      font-size: 36px;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .stat-card .stat-label {
      font-size: 14px;
      opacity: 0.8;
    }

    /* Table Styles */
    .table-container {
      overflow-x: auto;
      margin: 20px 0;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
    }

    table th {
      background: #f9fafb;
      padding: 15px;
      text-align: left;
      font-weight: 600;
      color: #374151;
      border-bottom: 2px solid #e5e7eb;
    }

    table td {
      padding: 15px;
      border-bottom: 1px solid #e5e7eb;
    }

    table tr:hover {
      background: #f9fafb;
    }

    .status-badge {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      display: inline-block;
    }

    .status-pending {
      background: #fef3c7;
      color: #92400e;
    }

    .status-approved {
      background: #d1fae5;
      color: #065f46;
    }

    .status-rejected {
      background: #fee2e2;
      color: #991b1b;
    }

    .status-active {
      background: #dbeafe;
      color: #1e40af;
    }

    /* Chat Styles */
    .chat-container {
      display: grid;
      grid-template-columns: 300px 1fr;
      gap: 20px;
      height: 600px;
    }

    .chat-users {
      background: #f9fafb;
      border-radius: 12px;
      padding: 20px;
      overflow-y: auto;
    }

    .chat-user {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s;
      margin-bottom: 10px;
    }

    .chat-user:hover {
      background: #e5e7eb;
    }

    .chat-user.active {
      background: #667eea;
      color: white;
    }

    .chat-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 18px;
    }

    .chat-main {
      display: flex;
      flex-direction: column;
      background: #f9fafb;
      border-radius: 12px;
    }

    .chat-header {
      padding: 20px;
      border-bottom: 2px solid #e5e7eb;
      background: white;
      border-radius: 12px 12px 0 0;
    }

    .chat-messages {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
    }

    .message {
      display: flex;
      margin-bottom: 20px;
      gap: 12px;
    }

    .message.sent {
      flex-direction: row-reverse;
    }

    .message-bubble {
      max-width: 70%;
      padding: 12px 16px;
      border-radius: 12px;
      background: white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .message.sent .message-bubble {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .message-sender {
      font-weight: 600;
      font-size: 12px;
      margin-bottom: 5px;
      opacity: 0.8;
    }

    .message-time {
      font-size: 11px;
      opacity: 0.6;
      margin-top: 5px;
    }

    .chat-input {
      display: flex;
      gap: 10px;
      padding: 20px;
      background: white;
      border-radius: 0 0 12px 12px;
      border-top: 2px solid #e5e7eb;
    }

    .chat-input input {
      flex: 1;
      padding: 12px;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      font-size: 14px;
    }

    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 20px;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: white;
      padding: 40px;
      border-radius: 15px;
      max-width: 500px;
      width: 100%;
      max-height: 90%;
      overflow-y: auto;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 28px;
      cursor: pointer;
      color: #6b7280;
    }

    /* Loading Spinner */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid #f3f4f6;
      border-top-color: #667eea;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .header-content {
        flex-direction: column;
        text-align: center;
      }

      .hero h1 {
        font-size: 32px;
      }

      .features-grid {
        grid-template-columns: 1fr;
      }

      .dashboard-grid {
        grid-template-columns: 1fr;
      }

      .chat-container {
        grid-template-columns: 1fr;
        height: auto;
      }

      .chat-users {
        height: 200px;
      }

      .page {
        padding: 20px;
      }

      table {
        font-size: 12px;
      }

      table th, table td {
        padding: 10px 5px;
      }
    }

    .action-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .btn-sm {
      padding: 8px 16px;
      font-size: 12px;
    }

    .file-upload {
      border: 2px dashed #e5e7eb;
      padding: 20px;
      text-align: center;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .file-upload:hover {
      border-color: #667eea;
      background: #f9fafb;
    }

    .file-upload input {
      display: none;
    }

    .section-title {
      font-size: 28px;
      margin-bottom: 20px;
      color: #1f2937;
      padding-bottom: 10px;
      border-bottom: 3px solid #667eea;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #6b7280;
    }

    .empty-state-icon {
      font-size: 64px;
      margin-bottom: 20px;
      opacity: 0.5;
    }
    #signupPage a{
      /* background: #4f69dd; */
      padding: 10px 15px;
      border-radius: 5px;
      border: 2px solid #667eea;
      transition: all 0.3s;
    }
    #signupPage a:hover{
      background: #667eea;
      color: white;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="container"><!-- Header -->
   <div class="header">
    <div class="header-content">
     <div class="logo" id="platformName">
      Community Savings
     </div>
     <div class="nav-controls"><select class="language-selector" id="languageSelector"> <option value="en">English</option> <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option> <option value="sw">Kiswahili</option> <option value="rw">Kinyarwanda</option> <option value="fr">Fran√ßais</option> </select>
      <div id="authButtons"></div>
     </div>
    </div>
   </div><!-- Home Page -->
   <div class="page active" id="homePage">
    <div class="hero">
     <h1 id="heroTitle">Building Financial Futures Together</h1>
     <p id="heroDescription">A comprehensive community-based savings and loan platform designed to empower members through collaborative financial management and transparent operations.</p>
     <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; margin-top: 30px;"><button class="btn btn-primary" onclick="showPage('loginPage')" id="getStartedBtn">Get Started</button> <button class="btn btn-secondary" onclick="showPage('contactPage')" id="contactUsBtn">Contact Us</button>
     </div>
    </div>
    <div class="features-grid">
     <div class="feature-card">
      <div class="feature-icon">
       üí∞
      </div>
      <h3 id="feature1Title">Secure Savings</h3>
      <p id="feature1Desc">Safely manage your community savings with transparent tracking and secure deposit verification system.</p>
     </div>
     <div class="feature-card">
      <div class="feature-icon">
       üìä
      </div>
      <h3 id="feature2Title">Financial Dashboard</h3>
      <p id="feature2Desc">Real-time overview of total balance, savings, active loans, and annual performance metrics.</p>
     </div>
     <div class="feature-card">
      <div class="feature-icon">
       ü§ù
      </div>
      <h3 id="feature3Title">Community Loans</h3>
      <p id="feature3Desc">Access affordable loans with transparent interest rates and fair repayment terms.</p>
     </div>
     <div class="feature-card">
      <div class="feature-icon">
       üí¨
      </div>
      <h3 id="feature4Title">Live Chat</h3>
      <p id="feature4Desc">Communicate directly with members and administrators in real-time.</p>
     </div>
     <div class="feature-card">
      <div class="feature-icon">
       üìà
      </div>
      <h3 id="feature5Title">Annual Reports</h3>
      <p id="feature5Desc">Comprehensive yearly financial reports with download and print capabilities.</p>
     </div>
     <div class="feature-card">
      <div class="feature-icon">
       üîê
      </div>
      <h3 id="feature6Title">Admin Control</h3>
      <p id="feature6Desc">Powerful administrative tools for system oversight and member management.</p>
     </div>
    </div>
   </div><!-- Login Page -->
   <div class="page" id="loginPage">
    <div class="form-container">
     <h2 class="section-title" id="loginTitle">Login</h2>
     <div id="loginError"></div>
     <form id="loginForm" onsubmit="handleLogin(event)">
      <div class="form-group"><label for="loginEmail" id="emailLabel">Email Address</label> <input type="email" id="loginEmail" required>
      </div>
      <div class="form-group"><label for="loginPassword" id="passwordLabel">Password</label>
       <div class="password-toggle"><input type="password" id="loginPassword" required> <button type="button" class="password-toggle-btn" onclick="togglePassword('loginPassword')">üëÅÔ∏è</button>
       </div>
      </div>
      <div class="form-group"><label for="loginRole" id="roleLabel">Login As</label> <select id="loginRole" required> <option value="member" id="memberOption">Member</option> <option value="admin" id="adminOption">Admin</option> </select>
      </div><button type="submit" class="btn btn-primary" style="width: 100%; margin-bottom: 15px;" id="loginBtn"> <span id="loginBtnText">Login</span> </button> <button type="button" class="btn btn-secondary" style="width: 100%; margin-bottom: 15px;" onclick="showPage('forgotPasswordPage')" id="forgotPasswordBtn">Forgot Password?</button> <button type="button" class="btn btn-secondary" style="width: 100%;" onclick="showPage('signupPage')" id="signupLinkBtn">Create New Account</button>
     </form>
    </div>
   </div><!-- Signup Page -->
   <div class="page" id="signupPage">
   <a href="./index.html">Back to Hompage</a>
    <div class="form-container">
     <h2 class="section-title" id="signupTitle">Create Account</h2>
     <div id="signupError"></div>
     <form id="signupForm" onsubmit="handleSignup(event)">
      <div class="form-group"><label for="signupFullName" id="fullNameLabel">Full Name</label> <input type="text" id="signupFullName" required>
      </div>
      <div class="form-group"><label for="signupEmail" id="signupEmailLabel">Email Address</label> <input type="email" id="signupEmail" required>
      </div>
      <div class="form-group"><label for="signupPhone" id="phoneLabel">Phone Number</label> <input type="tel" id="signupPhone" required>
      </div>
      <div class="form-group"><label for="signupPassword" id="signupPasswordLabel">Password</label>
       <div class="password-toggle"><input type="password" id="signupPassword" required minlength="6"> <button type="button" class="password-toggle-btn" onclick="togglePassword('signupPassword')">üëÅÔ∏è</button>
       </div>
      </div>
      <div class="form-group"><label for="signupRole" id="signupRoleLabel">Account Type</label> <select id="signupRole" required> <option value="member" id="signupMemberOption">Member</option> <option value="admin" id="signupAdminOption">Admin</option> </select>
      </div><button type="submit" class="btn btn-primary" style="width: 100%; margin-bottom: 15px;" id="signupBtn"> <span id="signupBtnText">Create Account</span> </button> <button type="button" class="btn btn-secondary" style="width: 100%;" onclick="showPage('loginPage')" id="loginLinkBtn">Already have an account? Login</button>
     </form>
    </div>
   </div><!-- Forgot Password Page -->
   <div class="page" id="forgotPasswordPage">
    <div class="form-container">
     <h2 class="section-title" id="forgotPasswordTitle">Reset Password</h2>
     <div id="forgotPasswordMessage"></div>
     <form id="forgotPasswordForm" onsubmit="handleForgotPassword(event)">
      <div class="form-group"><label for="forgotEmail" id="forgotEmailLabel">Email Address</label> <input type="email" id="forgotEmail" required>
      </div>
      <div class="form-group"><label for="newPassword" id="newPasswordLabel">New Password</label>
       <div class="password-toggle"><input type="password" id="newPassword" required minlength="6"> <button type="button" class="password-toggle-btn" onclick="togglePassword('newPassword')">üëÅÔ∏è</button>
       </div>
      </div><button type="submit" class="btn btn-primary" style="width: 100%; margin-bottom: 15px;" id="resetPasswordBtn"> <span id="resetPasswordBtnText">Reset Password</span> </button> <button type="button" class="btn btn-secondary" style="width: 100%;" onclick="showPage('loginPage')" id="backToLoginBtn">Back to Login</button>
     </form>
    </div>
   </div><!-- Dashboard Page -->
   <div class="page" id="dashboardPage">
    <h2 class="section-title" id="dashboardTitle">Financial Overview</h2>
    <div class="dashboard-grid">
     <div class="stat-card">
      <h3 id="totalBalanceLabel">Total Balance</h3>
      <div class="stat-value" id="totalBalance">
       0 RWF
      </div>
      <div class="stat-label" id="totalBalanceDesc">
       Community Funds
      </div>
     </div>
     <div class="stat-card">
      <h3 id="totalSavingsLabel">Total Savings</h3>
      <div class="stat-value" id="totalSavings">
       0 RWF
      </div>
      <div class="stat-label" id="totalSavingsDesc">
       Accumulated
      </div>
     </div>
     <div class="stat-card">
      <h3 id="activeLoansLabel">Active Loans</h3>
      <div class="stat-value" id="activeLoans">
       0
      </div>
      <div class="stat-label" id="activeLoansDesc">
       Members
      </div>
     </div>
     <div class="stat-card">
      <h3 id="annualCashOutLabel">Annual Cash-Out</h3>
      <div class="stat-value" id="annualCashOut">
       0 RWF
      </div>
      <div class="stat-label" id="annualCashOutDesc">
       This Year
      </div>
     </div>
    </div>
    <div id="dashboardContent"></div>
   </div><!-- Deposits Page -->
   <div class="page" id="depositsPage">
    <h2 class="section-title" id="depositsTitle">Deposit Management</h2><button class="btn btn-primary" style="margin-bottom: 20px;" onclick="showModal('depositModal')" id="newDepositBtn">New Deposit</button>
    <div class="table-container">
     <table id="depositsTable">
      <thead>
       <tr>
        <th id="depositMemberHeader">Member</th>
        <th id="depositAmountHeader">Amount</th>
        <th id="depositDateHeader">Date</th>
        <th id="depositProofHeader">Proof</th>
        <th id="depositStatusHeader">Status</th>
        <th id="depositActionsHeader">Actions</th>
       </tr>
      </thead>
      <tbody id="depositsTableBody">
      </tbody>
     </table>
    </div>
   </div><!-- Loans Page -->
   <div class="page" id="loansPage">
    <h2 class="section-title" id="loansTitle">Loans Management</h2><button class="btn btn-primary" style="margin-bottom: 20px;" onclick="showModal('loanModal')" id="applyLoanBtn">Apply for Loan</button>
    <div class="table-container">
     <table id="loansTable">
      <thead>
       <tr>
        <th id="loanMemberHeader">Member</th>
        <th id="loanAmountHeader">Amount</th>
        <th id="loanInterestHeader">Interest</th>
        <th id="loanTotalHeader">Total Due</th>
        <th id="loanDateHeader">Date</th>
        <th id="loanStatusHeader">Status</th>
        <th id="loanActionsHeader">Actions</th>
       </tr>
      </thead>
      <tbody id="loansTableBody">
      </tbody>
     </table>
    </div>
   </div><!-- Chat Page -->
   <div class="page" id="chatPage">
    <h2 class="section-title" id="chatTitle">Community Chat</h2>
    <div class="chat-container">
     <div class="chat-users" id="chatUsers"></div>
     <div class="chat-main">
      <div class="chat-header">
       <h3 id="chatWithName">Select a member to chat</h3>
      </div>
      <div class="chat-messages" id="chatMessages"></div>
      <div class="chat-input"><input type="text" id="messageInput" placeholder="Type a message..." disabled> <button class="btn btn-primary" onclick="sendMessage()" disabled id="sendMessageBtn">Send</button>
      </div>
     </div>
    </div>
   </div><!-- Audit Page -->
   <div class="page" id="auditPage">
    <h2 class="section-title" id="auditTitle">Audit Dashboard</h2>
    <div class="table-container">
     <table id="auditTable">
      <thead>
       <tr>
        <th id="auditTypeHeader">Type</th>
        <th id="auditDescHeader">Description</th>
        <th id="auditDateHeader">Date &amp; Time</th>
       </tr>
      </thead>
      <tbody id="auditTableBody">
      </tbody>
     </table>
    </div>
   </div><!-- Annual Report Page -->
   <div class="page" id="reportPage">
    <h2 class="section-title" id="reportTitle">Annual Report</h2>
    <div style="display: flex; gap: 15px; margin-bottom: 30px; flex-wrap: wrap;"><button class="btn btn-primary" onclick="downloadReport()" id="downloadReportBtn">üì• Download PDF</button> <button class="btn btn-secondary" onclick="printReport()" id="printReportBtn">üñ®Ô∏è Print Report</button>
    </div>
    <div id="reportContent"></div>
   </div><!-- Admin Panel Page -->
   <div class="page" id="adminPage">
    <h2 class="section-title" id="adminPanelTitle">Admin Panel</h2>
    <div id="adminContent"></div>
   </div><!-- Contact Page -->
   <div class="page" id="contactPage">
    <div class="form-container">
     <h2 class="section-title" id="contactTitle">Contact Us</h2>
     <div id="contactMessage"></div>
     <form id="contactForm" onsubmit="handleContact(event)">
      <div class="form-group"><label for="contactName" id="contactNameLabel">Full Name</label> <input type="text" id="contactName" required>
      </div>
      <div class="form-group"><label for="contactEmail" id="contactEmailLabel">Email Address</label> <input type="email" id="contactEmail" required>
      </div>
      <div class="form-group"><label for="contactPhone" id="contactPhoneLabel">Phone Number</label> <input type="tel" id="contactPhone" required>
      </div>
      <div class="form-group"><label for="contactSubject" id="contactSubjectLabel">Subject</label> <input type="text" id="contactSubject" required>
      </div>
      <div class="form-group"><label for="contactMessageText" id="contactMessageLabel">Message</label> <textarea id="contactMessageText" required></textarea>
      </div><button type="submit" class="btn btn-primary" style="width: 100%; margin-bottom: 15px;" id="contactSubmitBtn"> <span id="contactSubmitBtnText">Send Message</span> </button> <button type="button" class="btn btn-secondary" style="width: 100%;" onclick="showPage('homePage')" id="backToHomeBtn">Back to Home</button>
     </form>
    </div>
   </div>
  </div><!-- Deposit Modal -->
  <div class="modal" id="depositModal">
   <div class="modal-content">
    <div class="modal-header">
     <h3 id="depositModalTitle">New Deposit</h3><button class="modal-close" onclick="closeModal('depositModal')">√ó</button>
    </div>
    <form id="depositForm" onsubmit="handleDeposit(event)">
     <div class="form-group"><label for="depositAmount" id="depositAmountLabel">Amount (RWF)</label> <input type="number" id="depositAmount" required min="1">
     </div>
     <div class="form-group"><label id="depositProofLabel">Proof of Deposit</label>
      <div class="file-upload" onclick="document.getElementById('depositProof').click()">
       <p id="uploadProofText">üìé Click to upload proof</p><input type="file" id="depositProof" accept="image/*,.pdf" required>
      </div>
     </div><button type="submit" class="btn btn-primary" style="width: 100%;" id="submitDepositBtn"> <span id="submitDepositBtnText">Submit Deposit</span> </button>
    </form>
   </div>
  </div><!-- Loan Modal -->
  <div class="modal" id="loanModal">
   <div class="modal-content">
    <div class="modal-header">
     <h3 id="loanModalTitle">Apply for Loan</h3><button class="modal-close" onclick="closeModal('loanModal')">√ó</button>
    </div>
    <div id="loanModalMessage"></div>
    <form id="loanForm" onsubmit="handleLoanApplication(event)">
     <div class="form-group"><label for="loanAmount" id="loanAmountLabel">Loan Amount (RWF)</label> <input type="number" id="loanAmount" required min="1" oninput="calculateLoanInterest()">
     </div>
     <div class="form-group"><label id="loanInterestLabel">Interest (10% per 100 RWF)</label> <input type="text" id="loanInterest" readonly>
     </div>
     <div class="form-group"><label id="loanTotalLabel">Total to Repay</label> <input type="text" id="loanTotal" readonly>
     </div><button type="submit" class="btn btn-primary" style="width: 100%;" id="submitLoanBtn"> <span id="submitLoanBtnText">Apply for Loan</span> </button>
    </form>
   </div>
  </div>

  <script>
    // Mock Data SDK
    window.dataSdk = {
      async init(handler) {
        this.dataHandler = handler;
        // Initialize with empty data
        this.data = [];
        handler.onDataChanged(this.data);
        return { isOk: true };
      },
      
      async create(item) {
        item.__backendId = Date.now().toString();
        this.data.push(item);
        if (this.dataHandler) {
          this.dataHandler.onDataChanged(this.data);
        }
        return { isOk: true };
      },
      
      async update(item) {
        const index = this.data.findIndex(d => d.__backendId === item.__backendId);
        if (index !== -1) {
          this.data[index] = item;
          if (this.dataHandler) {
            this.dataHandler.onDataChanged(this.data);
          }
          return { isOk: true };
        }
        return { isOk: false };
      },
      
      async delete(item) {
        const index = this.data.findIndex(d => d.__backendId === item.__backendId);
        if (index !== -1) {
          this.data.splice(index, 1);
          if (this.dataHandler) {
            this.dataHandler.onDataChanged(this.data);
          }
          return { isOk: true };
        }
        return { isOk: false };
      }
    };

    // Mock Element SDK
    window.elementSdk = {
      async init(config) {
        this.config = config.defaultConfig || {};
        this.onConfigChange = config.onConfigChange;
        this.mapToCapabilities = config.mapToCapabilities;
        this.mapToEditPanelValues = config.mapToEditPanelValues;
        
        // Apply initial config
        if (this.onConfigChange) {
          this.onConfigChange(this.config);
        }
        return { isOk: true };
      },
      
      async setConfig(newConfig) {
        this.config = { ...this.config, ...newConfig };
        if (this.onConfigChange) {
          this.onConfigChange(this.config);
        }
        return { isOk: true };
      }
    };

    // Translation object
    const translations = {
      en: {
        platformName: "Community Savings",
        heroTitle: "Building Financial Futures Together",
        heroDescription: "A comprehensive community-based savings and loan platform designed to empower members through collaborative financial management and transparent operations.",
        getStartedBtn: "Get Started",
        contactUsBtn: "Contact Us",
        feature1Title: "Secure Savings",
        feature1Desc: "Safely manage your community savings with transparent tracking and secure deposit verification system.",
        feature2Title: "Financial Dashboard",
        feature2Desc: "Real-time overview of total balance, savings, active loans, and annual performance metrics.",
        feature3Title: "Community Loans",
        feature3Desc: "Access affordable loans with transparent interest rates and fair repayment terms.",
        feature4Title: "Live Chat",
        feature4Desc: "Communicate directly with members and administrators in real-time.",
        feature5Title: "Annual Reports",
        feature5Desc: "Comprehensive yearly financial reports with download and print capabilities.",
        feature6Title: "Admin Control",
        feature6Desc: "Powerful administrative tools for system oversight and member management.",
        loginTitle: "Login",
        emailLabel: "Email Address",
        passwordLabel: "Password",
        roleLabel: "Login As",
        memberOption: "Member",
        adminOption: "Admin",
        loginBtn: "Login",
        forgotPasswordBtn: "Forgot Password?",
        signupLinkBtn: "Create New Account",
        signupTitle: "Create Account",
        fullNameLabel: "Full Name",
        phoneLabel: "Phone Number",
        signupBtn: "Create Account",
        loginLinkBtn: "Already have an account? Login",
        forgotPasswordTitle: "Reset Password",
        newPasswordLabel: "New Password",
        resetPasswordBtn: "Reset Password",
        backToLoginBtn: "Back to Login",
        dashboardTitle: "Financial Overview",
        totalBalanceLabel: "Total Balance",
        totalBalanceDesc: "Community Funds",
        totalSavingsLabel: "Total Savings",
        totalSavingsDesc: "Accumulated",
        activeLoansLabel: "Active Loans",
        activeLoansDesc: "Members",
        annualCashOutLabel: "Annual Cash-Out",
        annualCashOutDesc: "This Year",
        depositsTitle: "Deposit Management",
        newDepositBtn: "New Deposit",
        loansTitle: "Loans Management",
        applyLoanBtn: "Apply for Loan",
        chatTitle: "Community Chat",
        sendMessageBtn: "Send",
        auditTitle: "Audit Dashboard",
        reportTitle: "Annual Report",
        downloadReportBtn: "üì• Download PDF",
        printReportBtn: "üñ®Ô∏è Print Report",
        adminPanelTitle: "Admin Panel",
        contactTitle: "Contact Us",
        contactSubmitBtn: "Send Message",
        backToHomeBtn: "Back to Home",
        depositModalTitle: "New Deposit",
        depositAmountLabel: "Amount (RWF)",
        depositProofLabel: "Proof of Deposit",
        uploadProofText: "üìé Click to upload proof",
        submitDepositBtn: "Submit Deposit",
        loanModalTitle: "Apply for Loan",
        loanInterestLabel: "Interest (10% per 100 RWF)",
        loanTotalLabel: "Total to Repay",
        submitLoanBtn: "Apply for Loan",
        logout: "Logout"
      },
      ar: {
        platformName: "ÿßÿØÿÆÿßÿ± ÿßŸÑŸÖÿ¨ÿ™ŸÖÿπ",
        heroTitle: "ÿ®ŸÜÿßÿ° ÿßŸÑŸÖÿ≥ÿ™ŸÇÿ®ŸÑ ÿßŸÑŸÖÿßŸÑŸä ŸÖÿπÿßŸã",
        heroDescription: "ŸÖŸÜÿµÿ© ÿ¥ÿßŸÖŸÑÿ© ŸÑŸÑÿßÿØÿÆÿßÿ± ŸàÿßŸÑŸÇÿ±Ÿàÿ∂ ÿßŸÑŸÖÿ¨ÿ™ŸÖÿπŸäÿ© ŸÖÿµŸÖŸÖÿ© ŸÑÿ™ŸÖŸÉŸäŸÜ ÿßŸÑÿ£ÿπÿ∂ÿßÿ° ŸÖŸÜ ÿÆŸÑÿßŸÑ ÿßŸÑÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿßŸÑŸäÿ© ÿßŸÑÿ™ÿπÿßŸàŸÜŸäÿ© ŸàÿßŸÑÿπŸÖŸÑŸäÿßÿ™ ÿßŸÑÿ¥ŸÅÿßŸÅÿ©.",
        getStartedBtn: "ÿßÿ®ÿØÿ£ ÿßŸÑÿ¢ŸÜ",
        contactUsBtn: "ÿßÿ™ÿµŸÑ ÿ®ŸÜÿß",
        feature1Title: "ÿßÿØÿÆÿßÿ± ÿ¢ŸÖŸÜ",
        feature1Desc: "ÿ•ÿØÿßÿ±ÿ© ŸÖÿØÿÆÿ±ÿßÿ™ ŸÖÿ¨ÿ™ŸÖÿπŸÉ ÿ®ÿ£ŸÖÿßŸÜ ŸÖÿπ ŸÜÿ∏ÿßŸÖ ÿ™ÿ™ÿ®ÿπ ÿ¥ŸÅÿßŸÅ ŸàÿßŸÑÿ™ÿ≠ŸÇŸÇ ÿßŸÑÿ¢ŸÖŸÜ ŸÖŸÜ ÿßŸÑŸàÿØÿßÿ¶ÿπ.",
        feature2Title: "ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ ÿßŸÑŸÖÿßŸÑŸäÿ©",
        feature2Desc: "ŸÜÿ∏ÿ±ÿ© ÿπÿßŸÖÿ© ŸÅŸä ÿßŸÑŸàŸÇÿ™ ÿßŸÑŸÅÿπŸÑŸä ÿπŸÑŸâ ÿßŸÑÿ±ÿµŸäÿØ ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä ŸàÿßŸÑŸÖÿØÿÆÿ±ÿßÿ™ ŸàÿßŸÑŸÇÿ±Ÿàÿ∂ ÿßŸÑŸÜÿ¥ÿ∑ÿ© ŸàŸÖŸÇÿßŸäŸäÿ≥ ÿßŸÑÿ£ÿØÿßÿ° ÿßŸÑÿ≥ŸÜŸàŸä.",
        feature3Title: "ŸÇÿ±Ÿàÿ∂ ÿßŸÑŸÖÿ¨ÿ™ŸÖÿπ",
        feature3Desc: "ÿßŸÑŸàÿµŸàŸÑ ÿ•ŸÑŸâ ŸÇÿ±Ÿàÿ∂ ŸÖŸäÿ≥Ÿàÿ±ÿ© ÿßŸÑÿ™ŸÉŸÑŸÅÿ© ÿ®ÿ£ÿ≥ÿπÿßÿ± ŸÅÿßÿ¶ÿØÿ© ÿ¥ŸÅÿßŸÅÿ© Ÿàÿ¥ÿ±Ÿàÿ∑ ÿ≥ÿØÿßÿØ ÿπÿßÿØŸÑÿ©.",
        feature4Title: "ÿØÿ±ÿØÿ¥ÿ© ÿ≠Ÿäÿ©",
        feature4Desc: "ÿßŸÑÿ™ŸàÿßÿµŸÑ ŸÖÿ®ÿßÿ¥ÿ±ÿ© ŸÖÿπ ÿßŸÑÿ£ÿπÿ∂ÿßÿ° ŸàÿßŸÑŸÖÿ≥ÿ§ŸàŸÑŸäŸÜ ŸÅŸä ÿßŸÑŸàŸÇÿ™ ÿßŸÑŸÅÿπŸÑŸä.",
        feature5Title: "ÿßŸÑÿ™ŸÇÿßÿ±Ÿäÿ± ÿßŸÑÿ≥ŸÜŸàŸäÿ©",
        feature5Desc: "ÿ™ŸÇÿßÿ±Ÿäÿ± ŸÖÿßŸÑŸäÿ© ÿ≥ŸÜŸàŸäÿ© ÿ¥ÿßŸÖŸÑÿ© ŸÖÿπ ÿ•ŸÖŸÉÿßŸÜŸäÿßÿ™ ÿßŸÑÿ™ŸÜÿ≤ŸäŸÑ ŸàÿßŸÑÿ∑ÿ®ÿßÿπÿ©.",
        feature6Title: "ÿ™ÿ≠ŸÉŸÖ ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ",
        feature6Desc: "ÿ£ÿØŸàÿßÿ™ ÿ•ÿØÿßÿ±Ÿäÿ© ŸÇŸàŸäÿ© ŸÑŸÑÿ•ÿ¥ÿ±ÿßŸÅ ÿπŸÑŸâ ÿßŸÑŸÜÿ∏ÿßŸÖ Ÿàÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ£ÿπÿ∂ÿßÿ°.",
        loginTitle: "ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ",
        emailLabel: "ÿπŸÜŸàÿßŸÜ ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä",
        passwordLabel: "ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±",
        roleLabel: "ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ŸÉŸÄ",
        memberOption: "ÿπÿ∂Ÿà",
        adminOption: "ŸÖÿ≥ÿ§ŸàŸÑ",
        loginBtn: "ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ",
        forgotPasswordBtn: "ŸÜÿ≥Ÿäÿ™ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±ÿü",
        signupLinkBtn: "ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ® ÿ¨ÿØŸäÿØ",
        signupTitle: "ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ®",
        fullNameLabel: "ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑŸÉÿßŸÖŸÑ",
        phoneLabel: "ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ",
        signupBtn: "ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ®",
        loginLinkBtn: "ŸáŸÑ ŸÑÿØŸäŸÉ ÿ≠ÿ≥ÿßÿ®ÿü ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ",
        forgotPasswordTitle: "ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±",
        newPasswordLabel: "ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿßŸÑÿ¨ÿØŸäÿØÿ©",
        resetPasswordBtn: "ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±",
        backToLoginBtn: "ÿßŸÑÿπŸàÿØÿ© ŸÑÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ",
        dashboardTitle: "ŸÜÿ∏ÿ±ÿ© ŸÖÿßŸÑŸäÿ© ÿπÿßŸÖÿ©",
        totalBalanceLabel: "ÿßŸÑÿ±ÿµŸäÿØ ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä",
        totalBalanceDesc: "ÿ£ŸÖŸàÿßŸÑ ÿßŸÑŸÖÿ¨ÿ™ŸÖÿπ",
        totalSavingsLabel: "ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖÿØÿÆÿ±ÿßÿ™",
        totalSavingsDesc: "ÿßŸÑŸÖÿ™ÿ±ÿßŸÉŸÖ",
        activeLoansLabel: "ÿßŸÑŸÇÿ±Ÿàÿ∂ ÿßŸÑŸÜÿ¥ÿ∑ÿ©",
        activeLoansDesc: "ÿßŸÑÿ£ÿπÿ∂ÿßÿ°",
        annualCashOutLabel: "ÿßŸÑÿ≥ÿ≠ÿ® ÿßŸÑÿ≥ŸÜŸàŸä",
        annualCashOutDesc: "Ÿáÿ∞ÿß ÿßŸÑÿπÿßŸÖ",
        depositsTitle: "ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸàÿØÿßÿ¶ÿπ",
        newDepositBtn: "ÿ•ŸäÿØÿßÿπ ÿ¨ÿØŸäÿØ",
        loansTitle: "ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÇÿ±Ÿàÿ∂",
        applyLoanBtn: "ÿßŸÑÿ™ŸÇÿØŸÖ ŸÑŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÇÿ±ÿ∂",
        chatTitle: "ÿØÿ±ÿØÿ¥ÿ© ÿßŸÑŸÖÿ¨ÿ™ŸÖÿπ",
        sendMessageBtn: "ÿ•ÿ±ÿ≥ÿßŸÑ",
        auditTitle: "ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖÿ±ÿßÿ¨ÿπÿ©",
        reportTitle: "ÿßŸÑÿ™ŸÇÿ±Ÿäÿ± ÿßŸÑÿ≥ŸÜŸàŸä",
        downloadReportBtn: "üì• ÿ™ŸÜÿ≤ŸäŸÑ PDF",
        printReportBtn: "üñ®Ô∏è ÿ∑ÿ®ÿßÿπÿ© ÿßŸÑÿ™ŸÇÿ±Ÿäÿ±",
        adminPanelTitle: "ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ",
        contactTitle: "ÿßÿ™ÿµŸÑ ÿ®ŸÜÿß",
        contactSubmitBtn: "ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©",
        backToHomeBtn: "ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑÿµŸÅÿ≠ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©",
        depositModalTitle: "ÿ•ŸäÿØÿßÿπ ÿ¨ÿØŸäÿØ",
        depositAmountLabel: "ÿßŸÑŸÖÿ®ŸÑÿ∫ (RWF)",
        depositProofLabel: "ÿ•ÿ´ÿ®ÿßÿ™ ÿßŸÑÿ•ŸäÿØÿßÿπ",
        uploadProofText: "üìé ÿßŸÜŸÇÿ± ŸÑÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ•ÿ´ÿ®ÿßÿ™",
        submitDepositBtn: "ÿ™ŸÇÿØŸäŸÖ ÿßŸÑÿ•ŸäÿØÿßÿπ",
        loanModalTitle: "ÿßŸÑÿ™ŸÇÿØŸÖ ŸÑŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÇÿ±ÿ∂",
        loanInterestLabel: "ÿßŸÑŸÅÿßÿ¶ÿØÿ© (10Ÿ™ ŸÑŸÉŸÑ 100 RWF)",
        loanTotalLabel: "ÿßŸÑŸÖÿ¨ŸÖŸàÿπ ŸÑŸÑÿ≥ÿØÿßÿØ",
        submitLoanBtn: "ÿßŸÑÿ™ŸÇÿØŸÖ ŸÑŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÇÿ±ÿ∂",
        logout: "ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨"
      },
      sw: {
        platformName: "Akiba ya Jamii",
        heroTitle: "Kujenga Maisha ya Kifedha Pamoja",
        heroDescription: "Jukwaa kamili la akiba na mikopo ya jamii lililobuniwa kuwajengea wanachama kupitia usimamizi wa kifedha wa ushirikiano na uendeshaji ulio wazi.",
        getStartedBtn: "Anza Sasa",
        contactUsBtn: "Wasiliana Nasi",
        feature1Title: "Akiba Salama",
        feature1Desc: "Simamia akiba ya jamii yako kwa usalama na mfumo wa ufuatiliaji ulio wazi na uthibitisho salama wa amana.",
        feature2Title: "Dashibodi ya Fedha",
        feature2Desc: "Muhtasari wa wakati halisi wa jumla ya salio, akiba, mikopo inayotumika na vipimo vya utendaji wa kila mwaka.",
        feature3Title: "Mikopo ya Jamii",
        feature3Desc: "Pata mikopo inayoweza kufikika na viwango vya riba vilivyo wazi na masharti ya malipo ya haki.",
        feature4Title: "Gumzo Moja kwa Moja",
        feature4Desc: "Wasiliana moja kwa moja na wanachama na wasimamizi kwa wakati halisi.",
        feature5Title: "Ripoti za Kila Mwaka",
        feature5Desc: "Ripoti kamili za kifedha za kila mwaka zenye uwezo wa kupakua na kuchapisha.",
        feature6Title: "Udhibiti wa Msimamizi",
        feature6Desc: "Zana nguvu za uongozi kwa usimamizi wa mfumo na usimamizi wa wanachama.",
        loginTitle: "Ingia",
        emailLabel: "Anwani ya Barua Pepe",
        passwordLabel: "Neno la Siri",
        roleLabel: "Ingia Kama",
        memberOption: "Mwanachama",
        adminOption: "Msimamizi",
        loginBtn: "Ingia",
        forgotPasswordBtn: "Umesahau Neno la Siri?",
        signupLinkBtn: "Fungua Akaunti Mpya",
        signupTitle: "Fungua Akaunti",
        fullNameLabel: "Jina Kamili",
        phoneLabel: "Nambari ya Simu",
        signupBtn: "Fungua Akaunti",
        loginLinkBtn: "Je, una akaunti? Ingia",
        forgotPasswordTitle: "Weka Upya Neno la Siri",
        newPasswordLabel: "Neno Jipya la Siri",
        resetPasswordBtn: "Weka Upya Neno la Siri",
        backToLoginBtn: "Rudi kwa Kuingia",
        dashboardTitle: "Muhtasari wa Fedha",
        totalBalanceLabel: "Jumla ya Salio",
        totalBalanceDesc: "Fedha za Jamii",
        totalSavingsLabel: "Jumla ya Akiba",
        totalSavingsDesc: "Zilizokusanywa",
        activeLoansLabel: "Mikopo Inayotumika",
        activeLoansDesc: "Wanachama",
        annualCashOutLabel: "Kutoa Pesa Kila Mwaka",
        annualCashOutDesc: "Mwaka Huu",
        depositsTitle: "Usimamizi wa Amana",
        newDepositBtn: "Amana Mpya",
        loansTitle: "Usimamizi wa Mikopo",
        applyLoanBtn: "Omba Mkopo",
        chatTitle: "Gumzo la Jamii",
        sendMessageBtn: "Tuma",
        auditTitle: "Dashibodi ya Ukaguzi",
        reportTitle: "Ripoti ya Kila Mwaka",
        downloadReportBtn: "üì• Pakua PDF",
        printReportBtn: "üñ®Ô∏è Chapisha Ripoti",
        adminPanelTitle: "Paneli ya Msimamizi",
        contactTitle: "Wasiliana Nasi",
        contactSubmitBtn: "Tuma Ujumbe",
        backToHomeBtn: "Rudi Nyumbani",
        depositModalTitle: "Amana Mpya",
        depositAmountLabel: "Kiasi (RWF)",
        depositProofLabel: "Uthibitisho wa Amana",
        uploadProofText: "üìé Bonyeza kupakia uthibitisho",
        submitDepositBtn: "Wasilisha Amana",
        loanModalTitle: "Omba Mkopo",
        loanInterestLabel: "Riba (10% kwa kila 100 RWF)",
        loanTotalLabel: "Jumla ya Kulipa",
        submitLoanBtn: "Omba Mkopo",
        logout: "Toka"
      },
      rw: {
        platformName: "Ikigega cy'Abaturage",
        heroTitle: "Kubaka Ejo Hazaza h'Imari Hamwe",
        heroDescription: "Urubuga rwuzuye rw'ikigega n'inguzanyo z'abaturage rwubatswe kongera imbaraga abanyamuryango binyuze mu micungire y'imari y'ubufatanye n'ibikorwa bisobanutse.",
        getStartedBtn: "Tangira Nonaha",
        contactUsBtn: "Duhamagare",
        feature1Title: "Ikigega Gitekanye",
        feature1Desc: "Genzura neza ikigega cy'umuryango wawe hamwe na sisitemu isobanutse yo gukurikirana no kwemeza neza imari zinjira.",
        feature2Title: "Ikibaho cy'Imari",
        feature2Desc: "Incamake y'igihe nyacyo y'amafaranga yose, ikigega, inguzanyo zikoreshwa n'ibipimo by'imikorere ya buri mwaka.",
        feature3Title: "Inguzanyo z'Abaturage",
        feature3Desc: "Kubona inguzanyo zihendutse hamwe n'inyungu zisobanutse n'amabwiriza yo kwishyura atagereranywa.",
        feature4Title: "Guhagarikirana mu Gihe Nyacyo",
        feature4Desc: "Vugana muburyo butaziguye n'abanyamuryango n'abayobozi mu gihe nyacyo.",
        feature5Title: "Raporo y'Umwaka",
        feature5Desc: "Raporo zuzuye z'imari za buri mwaka zifite ubushobozi bwo gukuramo no gucapa.",
        feature6Title: "Ubugenzuzi bw'Umuyobozi",
        feature6Desc: "Ibikoresho bikomeye by'ubuyobozi kugira ngo bigenzure sisitemu no gucunga abanyamuryango.",
        loginTitle: "Injira",
        emailLabel: "Aderesi ya Imeyili",
        passwordLabel: "Ijambo ry'Ibanga",
        roleLabel: "Injira Nka",
        memberOption: "Umunyamuryango",
        adminOption: "Umuyobozi",
        loginBtn: "Injira",
        forgotPasswordBtn: "Wibagiwe Ijambo ry'Ibanga?",
        signupLinkBtn: "Fungura Konti Nshya",
        signupTitle: "Fungura Konti",
        fullNameLabel: "Amazina Yose",
        phoneLabel: "Nimero ya Telefoni",
        signupBtn: "Fungura Konti",
        loginLinkBtn: "Ufite konti? Injira",
        forgotPasswordTitle: "Subiza Ijambo ry'Ibanga",
        newPasswordLabel: "Ijambo Rishya ry'Ibanga",
        resetPasswordBtn: "Subiza Ijambo ry'Ibanga",
        backToLoginBtn: "Subira Kwinjira",
        dashboardTitle: "Incamake y'Imari",
        totalBalanceLabel: "Amafaranga Yose",
        totalBalanceDesc: "Umutungo w'Abaturage",
        totalSavingsLabel: "Ikigega Cyose",
        totalSavingsDesc: "Cyegeranyijwe",
        activeLoansLabel: "Inguzanyo Zikoreshwa",
        activeLoansDesc: "Abanyamuryango",
        annualCashOutLabel: "Amafaranga Yasohotse mu Mwaka",
        annualCashOutDesc: "Uyu Mwaka",
        depositsTitle: "Imicungire y'Amashyirwa mu Kigega",
        newDepositBtn: "Ishyirwa mu Kigega Rishya",
        loansTitle: "Imicungire y'Inguzanyo",
        applyLoanBtn: "Saba Inguzanyo",
        chatTitle: "Ibiganiro by'Abaturage",
        sendMessageBtn: "Ohereza",
        auditTitle: "Ikibaho cy'Igenzura",
        reportTitle: "Raporo y'Umwaka",
        downloadReportBtn: "üì• Kuramo PDF",
        printReportBtn: "üñ®Ô∏è Gucapa Raporo",
        adminPanelTitle: "Ikibanza cy'Umuyobozi",
        contactTitle: "Duhamagare",
        contactSubmitBtn: "Ohereza Ubutumwa",
        backToHomeBtn: "Subira Ahabanza",
        depositModalTitle: "Ishyirwa mu Kigega Rishya",
        depositAmountLabel: "Amafaranga (RWF)",
        depositProofLabel: "Icyemezo cy'Ishyirwa mu Kigega",
        uploadProofText: "üìé Kanda kugira ngo ushyireho icyemezo",
        submitDepositBtn: "Tanga Ishyirwa mu Kigega",
        loanModalTitle: "Saba Inguzanyo",
        loanInterestLabel: "Inyungu (10% ku 100 RWF)",
        loanTotalLabel: "Igiteranyo cyo Kwishyura",
        submitLoanBtn: "Saba Inguzanyo",
        logout: "Sohoka"
      },
      fr: {
        platformName: "√âpargne Communautaire",
        heroTitle: "Construire Ensemble l'Avenir Financier",
        heroDescription: "Une plateforme compl√®te d'√©pargne et de pr√™ts communautaires con√ßue pour autonomiser les membres gr√¢ce √† une gestion financi√®re collaborative et des op√©rations transparentes.",
        getStartedBtn: "Commencer",
        contactUsBtn: "Contactez-nous",
        feature1Title: "√âpargne S√©curis√©e",
        feature1Desc: "G√©rez en toute s√©curit√© l'√©pargne de votre communaut√© avec un syst√®me de suivi transparent et de v√©rification s√©curis√©e des d√©p√¥ts.",
        feature2Title: "Tableau de Bord Financier",
        feature2Desc: "Aper√ßu en temps r√©el du solde total, de l'√©pargne, des pr√™ts actifs et des indicateurs de performance annuels.",
        feature3Title: "Pr√™ts Communautaires",
        feature3Desc: "Acc√©dez √† des pr√™ts abordables avec des taux d'int√©r√™t transparents et des conditions de remboursement √©quitables.",
        feature4Title: "Chat en Direct",
        feature4Desc: "Communiquez directement avec les membres et les administrateurs en temps r√©el.",
        feature5Title: "Rapports Annuels",
        feature5Desc: "Rapports financiers annuels complets avec possibilit√© de t√©l√©chargement et d'impression.",
        feature6Title: "Contr√¥le Administrateur",
        feature6Desc: "Outils administratifs puissants pour la supervision du syst√®me et la gestion des membres.",
        loginTitle: "Connexion",
        emailLabel: "Adresse Email",
        passwordLabel: "Mot de Passe",
        roleLabel: "Se Connecter En Tant Que",
        memberOption: "Membre",
        adminOption: "Administrateur",
        loginBtn: "Se Connecter",
        forgotPasswordBtn: "Mot de Passe Oubli√©?",
        signupLinkBtn: "Cr√©er un Nouveau Compte",
        signupTitle: "Cr√©er un Compte",
        fullNameLabel: "Nom Complet",
        phoneLabel: "Num√©ro de T√©l√©phone",
        signupBtn: "Cr√©er un Compte",
        loginLinkBtn: "Vous avez d√©j√† un compte? Connexion",
        forgotPasswordTitle: "R√©initialiser le Mot de Passe",
        newPasswordLabel: "Nouveau Mot de Passe",
        resetPasswordBtn: "R√©initialiser le Mot de Passe",
        backToLoginBtn: "Retour √† la Connexion",
        dashboardTitle: "Aper√ßu Financier",
        totalBalanceLabel: "Solde Total",
        totalBalanceDesc: "Fonds Communautaires",
        totalSavingsLabel: "√âpargne Totale",
        totalSavingsDesc: "Accumul√©e",
        activeLoansLabel: "Pr√™ts Actifs",
        activeLoansDesc: "Membres",
        annualCashOutLabel: "Retrait Annuel",
        annualCashOutDesc: "Cette Ann√©e",
        depositsTitle: "Gestion des D√©p√¥ts",
        newDepositBtn: "Nouveau D√©p√¥t",
        loansTitle: "Gestion des Pr√™ts",
        applyLoanBtn: "Demander un Pr√™t",
        chatTitle: "Chat Communautaire",
        sendMessageBtn: "Envoyer",
        auditTitle: "Tableau d'Audit",
        reportTitle: "Rapport Annuel",
        downloadReportBtn: "üì• T√©l√©charger PDF",
        printReportBtn: "üñ®Ô∏è Imprimer le Rapport",
        adminPanelTitle: "Panneau Administrateur",
        contactTitle: "Contactez-nous",
        contactSubmitBtn: "Envoyer le Message",
        backToHomeBtn: "Retour √† l'Accueil",
        depositModalTitle: "Nouveau D√©p√¥t",
        depositAmountLabel: "Montant (RWF)",
        depositProofLabel: "Preuve de D√©p√¥t",
        uploadProofText: "üìé Cliquez pour t√©l√©charger la preuve",
        submitDepositBtn: "Soumettre le D√©p√¥t",
        loanModalTitle: "Demander un Pr√™t",
        loanInterestLabel: "Int√©r√™t (10% par 100 RWF)",
        loanTotalLabel: "Total √† Rembourser",
        submitLoanBtn: "Demander un Pr√™t",
        logout: "D√©connexion"
      }
    };

    // Global state
    let currentUser = null;
    let currentLanguage = 'en';
    let allData = [];
    let selectedChatUser = null;

    const defaultConfig = {
      platform_name: "Community Savings",
      tagline: "Building Financial Futures Together",
      footer_text: "¬© 2024 Community Savings. All rights reserved.",
      background_color: "#667eea",
      surface_color: "#ffffff",
      text_color: "#1f2937",
      primary_action_color: "#667eea",
      secondary_action_color: "#764ba2",
      font_family: "Segoe UI",
      font_size: 16
    };

    // Data handler
    const dataHandler = {
      onDataChanged(data) {
        allData = data;
        if (currentUser) {
          updateDashboard();
          updateDepositsTable();
          updateLoansTable();
          updateChatUsers();
          updateAuditTable();
          updateAdminPanel();
        }
      }
    };

    // Initialize SDK
    async function initializeApp() {
      const initResult = await window.dataSdk.init(dataHandler);
      if (!initResult.isOk) {
        console.error("Failed to initialize Data SDK");
        return;
      }

      await window.elementSdk.init({
        defaultConfig,
        onConfigChange: async (config) => {
          document.getElementById('platformName').textContent = config.platform_name || defaultConfig.platform_name;
          document.body.style.background = `linear-gradient(135deg, ${config.background_color || defaultConfig.background_color} 0%, ${config.secondary_action_color || defaultConfig.secondary_action_color} 100%)`;
          
          const customFont = config.font_family || defaultConfig.font_family;
          const baseFontStack = 'Tahoma, Geneva, Verdana, sans-serif';
          document.body.style.fontFamily = `${customFont}, ${baseFontStack}`;
          
          const baseSize = config.font_size || defaultConfig.font_size;
          document.body.style.fontSize = `${baseSize}px`;
          
          const allButtons = document.querySelectorAll('.btn-primary');
          allButtons.forEach(btn => {
            btn.style.background = `linear-gradient(135deg, ${config.primary_action_color || defaultConfig.primary_action_color} 0%, ${config.secondary_action_color || defaultConfig.secondary_action_color} 100%)`;
          });
        },
        mapToCapabilities: (config) => ({
          recolorables: [
            {
              get: () => config.background_color || defaultConfig.background_color,
              set: (value) => {
                config.background_color = value;
                window.elementSdk.setConfig({ background_color: value });
              }
            },
            {
              get: () => config.surface_color || defaultConfig.surface_color,
              set: (value) => {
                config.surface_color = value;
                window.elementSdk.setConfig({ surface_color: value });
              }
            },
            {
              get: () => config.text_color || defaultConfig.text_color,
              set: (value) => {
                config.text_color = value;
                window.elementSdk.setConfig({ text_color: value });
              }
            },
            {
              get: () => config.primary_action_color || defaultConfig.primary_action_color,
              set: (value) => {
                config.primary_action_color = value;
                window.elementSdk.setConfig({ primary_action_color: value });
              }
            },
            {
              get: () => config.secondary_action_color || defaultConfig.secondary_action_color,
              set: (value) => {
                config.secondary_action_color = value;
                window.elementSdk.setConfig({ secondary_action_color: value });
              }
            }
          ],
          borderables: [],
          fontEditable: {
            get: () => config.font_family || defaultConfig.font_family,
            set: (value) => {
              config.font_family = value;
              window.elementSdk.setConfig({ font_family: value });
            }
          },
          fontSizeable: {
            get: () => config.font_size || defaultConfig.font_size,
            set: (value) => {
              config.font_size = value;
              window.elementSdk.setConfig({ font_size: value });
            }
          }
        }),
        mapToEditPanelValues: (config) => new Map([
          ["platform_name", config.platform_name || defaultConfig.platform_name],
          ["tagline", config.tagline || defaultConfig.tagline],
          ["footer_text", config.footer_text || defaultConfig.footer_text]
        ])
      });

      updateAuthButtons();
    }

    // Page navigation
    function showPage(pageId) {
      document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
      document.getElementById(pageId).classList.add('active');
      
      if (pageId === 'dashboardPage' && currentUser) {
        updateDashboard();
      } else if (pageId === 'depositsPage' && currentUser) {
        updateDepositsTable();
      } else if (pageId === 'loansPage' && currentUser) {
        updateLoansTable();
      } else if (pageId === 'chatPage' && currentUser) {
        updateChatUsers();
      } else if (pageId === 'auditPage' && currentUser) {
        updateAuditTable();
      } else if (pageId === 'reportPage' && currentUser) {
        updateAnnualReport();
      } else if (pageId === 'adminPage' && currentUser && currentUser.role === 'admin') {
        updateAdminPanel();
      }
    }

    // Authentication
    function updateAuthButtons() {
      const authButtonsDiv = document.getElementById('authButtons');
      
      if (currentUser) {
        const navItems = [
          { page: 'dashboardPage', label: 'Dashboard', key: 'dashboardTitle' },
          { page: 'depositsPage', label: 'Deposits', key: 'depositsTitle' },
          { page: 'loansPage', label: 'Loans', key: 'loansTitle' },
          { page: 'chatPage', label: 'Chat', key: 'chatTitle' }
        ];
        
        if (currentUser.role === 'admin') {
          navItems.push(
            { page: 'auditPage', label: 'Audit', key: 'auditTitle' },
            { page: 'reportPage', label: 'Report', key: 'reportTitle' },
            { page: 'adminPage', label: 'Admin', key: 'adminPanelTitle' }
          );
        }
        
        authButtonsDiv.innerHTML = navItems.map(item => 
          `<button class="btn btn-secondary" onclick="showPage('${item.page}')">${translations[currentLanguage][item.key]}</button>`
        ).join('') + `<button class="btn btn-danger" onclick="logout()">${translations[currentLanguage].logout}</button>`;
      } else {
        authButtonsDiv.innerHTML = `
          <button class="btn btn-secondary" onclick="showPage('loginPage')">${translations[currentLanguage].loginBtn}</button>
          <button class="btn btn-primary" onclick="showPage('signupPage')">${translations[currentLanguage].signupBtn}</button>
        `;
      }
    }

    async function handleLogin(event) {
      event.preventDefault();
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;
      const role = document.getElementById('loginRole').value;
      
      const loginBtn = document.querySelector('#loginForm button[type="submit"]');
      loginBtn.disabled = true;
      loginBtn.innerHTML = '<span class="loading"></span>';
      
      const users = allData.filter(d => d.__type === 'user');
      const user = users.find(u => u.email === email && u.password === password && u.role === role);
      
      if (!user) {
        showError('loginError', 'Invalid email, password, or role');
        loginBtn.disabled = false;
        loginBtn.innerHTML = translations[currentLanguage].loginBtn;
        return;
      }
      
      if (role === 'member' && !user.approved) {
        showError('loginError', 'Your account is pending admin approval');
        loginBtn.disabled = false;
        loginBtn.innerHTML = translations[currentLanguage].loginBtn;
        return;
      }
      
      currentUser = user;
      await logActivity('login', `${user.fullName} logged in as ${user.role}`);
      
      updateAuthButtons();
      showPage('dashboardPage');
      
      loginBtn.disabled = false;
      loginBtn.innerHTML = translations[currentLanguage].loginBtn;
      document.getElementById('loginForm').reset();
    }

    async function handleSignup(event) {
      event.preventDefault();
      const fullName = document.getElementById('signupFullName').value;
      const email = document.getElementById('signupEmail').value;
      const phone = document.getElementById('signupPhone').value;
      const password = document.getElementById('signupPassword').value;
      const role = document.getElementById('signupRole').value;
      
      const signupBtn = document.querySelector('#signupForm button[type="submit"]');
      signupBtn.disabled = true;
      signupBtn.innerHTML = '<span class="loading"></span>';
      
      const users = allData.filter(d => d.__type === 'user');
      
      if (users.find(u => u.email === email)) {
        showError('signupError', 'Email already registered');
        signupBtn.disabled = false;
        signupBtn.innerHTML = translations[currentLanguage].signupBtn;
        return;
      }
      
      if (role === 'admin') {
        const adminCount = users.filter(u => u.role === 'admin').length;
        if (adminCount >= 3) {
          showError('signupError', 'Maximum 3 admin accounts allowed');
          signupBtn.disabled = false;
          signupBtn.innerHTML = translations[currentLanguage].signupBtn;
          return;
        }
      }
      
      const newUser = {
        __type: 'user',
        id: Date.now().toString(),
        email,
        password,
        fullName,
        phone,
        role,
        approved: role === 'admin',
        profilePhoto: fullName.charAt(0).toUpperCase(),
        createdAt: new Date().toISOString()
      };
      
      const result = await window.dataSdk.create(newUser);
      
      if (result.isOk) {
        await logActivity('signup', `${fullName} created ${role} account`);
        showSuccess('signupError', role === 'member' ? 'Account created! Awaiting admin approval' : 'Admin account created successfully!');
        setTimeout(() => showPage('loginPage'), 2000);
      } else {
        showError('signupError', 'Failed to create account');
      }
      
      signupBtn.disabled = false;
      signupBtn.innerHTML = translations[currentLanguage].signupBtn;
    }

    async function handleForgotPassword(event) {
      event.preventDefault();
      const email = document.getElementById('forgotEmail').value;
      const newPassword = document.getElementById('newPassword').value;
      
      const resetBtn = document.querySelector('#forgotPasswordForm button[type="submit"]');
      resetBtn.disabled = true;
      resetBtn.innerHTML = '<span class="loading"></span>';
      
      const users = allData.filter(d => d.__type === 'user');
      const user = users.find(u => u.email === email);
      
      if (!user) {
        showError('forgotPasswordMessage', 'Email not found');
        resetBtn.disabled = false;
        resetBtn.innerHTML = translations[currentLanguage].resetPasswordBtn;
        return;
      }
      
      user.password = newPassword;
      const result = await window.dataSdk.update(user);
      
      if (result.isOk) {
        await logActivity('password_reset', `Password reset for ${user.email}`);
        showSuccess('forgotPasswordMessage', 'Password reset successfully!');
        setTimeout(() => showPage('loginPage'), 2000);
      } else {
        showError('forgotPasswordMessage', 'Failed to reset password');
      }
      
      resetBtn.disabled = false;
      resetBtn.innerHTML = translations[currentLanguage].resetPasswordBtn;
    }

    function logout() {
      logActivity('logout', `${currentUser.fullName} logged out`);
      currentUser = null;
      updateAuthButtons();
      showPage('homePage');
    }

    // Dashboard
    function updateDashboard() {
      const deposits = allData.filter(d => d.__type === 'deposit' && d.depositStatus === 'approved');
      const loans = allData.filter(d => d.__type === 'loan' && d.loanStatus === 'active');
      
      const totalSavings = deposits.reduce((sum, d) => sum + (d.depositAmount || 0), 0);
      const totalLoansAmount = loans.reduce((sum, l) => sum + (l.loanAmount || 0) + (l.loanInterest || 0), 0);
      const totalBalance = totalSavings - totalLoansAmount;
      
      document.getElementById('totalBalance').textContent = `${totalBalance.toLocaleString()} RWF`;
      document.getElementById('totalSavings').textContent = `${totalSavings.toLocaleString()} RWF`;
      document.getElementById('activeLoans').textContent = loans.length;
      
      const currentYear = new Date().getFullYear();
      const yearlyWithdrawals = allData.filter(d => 
        d.__type === 'loan' && 
        d.loanStatus === 'active' && 
        new Date(d.loanDate).getFullYear() === currentYear
      ).reduce((sum, l) => sum + (l.loanAmount || 0), 0);
      
      document.getElementById('annualCashOut').textContent = `${yearlyWithdrawals.toLocaleString()} RWF`;
    }

    // Deposits
    function updateDepositsTable() {
      const deposits = allData.filter(d => d.__type === 'deposit');
      const users = allData.filter(d => d.__type === 'user');
      const tbody = document.getElementById('depositsTableBody');
      
      if (deposits.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" class="empty-state"><div class="empty-state-icon">üì≠</div><p>No deposits yet</p></td></tr>';
        return;
      }
      
      tbody.innerHTML = deposits.map(deposit => {
        const user = users.find(u => u.id === deposit.depositFrom);
        const userName = user ? user.fullName : 'Unknown';
        const canManage = currentUser.role === 'admin' && deposit.depositStatus === 'pending';
        
        return `
          <tr>
            <td>${userName}</td>
            <td>${deposit.depositAmount} RWF</td>
            <td>${new Date(deposit.depositDate).toLocaleDateString()}</td>
            <td>${deposit.depositProof ? 'üìé File attached' : 'No proof'}</td>
            <td><span class="status-badge status-${deposit.depositStatus}">${deposit.depositStatus}</span></td>
            <td>
              ${canManage ? `
                <div class="action-buttons">
                  <button class="btn btn-success btn-sm" onclick="approveDeposit('${deposit.__backendId}')">Accept</button>
                  <button class="btn btn-danger btn-sm" onclick="rejectDeposit('${deposit.__backendId}')">Reject</button>
                </div>
              ` : '-'}
            </td>
          </tr>
        `;
      }).join('');
    }

    async function handleDeposit(event) {
      event.preventDefault();
      const amount = parseFloat(document.getElementById('depositAmount').value);
      const proofFile = document.getElementById('depositProof').files[0];
      
      if (allData.filter(d => d.__type === 'deposit').length >= 999) {
        showError('depositForm', 'Maximum limit of 999 deposits reached');
        return;
      }
      
      const submitBtn = document.querySelector('#depositForm button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<span class="loading"></span>';
      
      const deposit = {
        __type: 'deposit',
        id: Date.now().toString(),
        depositAmount: amount,
        depositFrom: currentUser.id,
        depositProof: proofFile ? proofFile.name : '',
        depositDate: new Date().toISOString(),
        depositStatus: 'pending'
      };
      
      const result = await window.dataSdk.create(deposit);
      
      if (result.isOk) {
        await logActivity('deposit_created', `${currentUser.fullName} submitted deposit of ${amount} RWF`);
        closeModal('depositModal');
        document.getElementById('depositForm').reset();
      }
      
      submitBtn.disabled = false;
      submitBtn.innerHTML = translations[currentLanguage].submitDepositBtn;
    }

    async function approveDeposit(backendId) {
      const deposit = allData.find(d => d.__backendId === backendId);
      if (!deposit) return;
      
      deposit.depositStatus = 'approved';
      const result = await window.dataSdk.update(deposit);
      
      if (result.isOk) {
        await logActivity('deposit_approved', `Admin approved deposit of ${deposit.depositAmount} RWF`);
      }
    }

    async function rejectDeposit(backendId) {
      const deposit = allData.find(d => d.__backendId === backendId);
      if (!deposit) return;
      
      deposit.depositStatus = 'rejected';
      const result = await window.dataSdk.update(deposit);
      
      if (result.isOk) {
        await logActivity('deposit_rejected', `Admin rejected deposit of ${deposit.depositAmount} RWF`);
      }
    }

    // Loans
    function updateLoansTable() {
      const loans = allData.filter(d => d.__type === 'loan');
      const users = allData.filter(d => d.__type === 'user');
      const tbody = document.getElementById('loansTableBody');
      
      if (loans.length === 0) {
        tbody.innerHTML = '<tr><td colspan="7" class="empty-state"><div class="empty-state-icon">üí∞</div><p>No loans yet</p></td></tr>';
        return;
      }
      
      tbody.innerHTML = loans.map(loan => {
        const user = users.find(u => u.id === loan.loanFrom);
        const userName = user ? user.fullName : 'Unknown';
        const total = (loan.loanAmount || 0) + (loan.loanInterest || 0);
        const canManage = currentUser.role === 'admin' && loan.loanStatus === 'pending';
        
        return `
          <tr>
            <td>${userName}</td>
            <td>${loan.loanAmount} RWF</td>
            <td>${loan.loanInterest} RWF</td>
            <td>${total} RWF</td>
            <td>${new Date(loan.loanDate).toLocaleDateString()}</td>
            <td><span class="status-badge status-${loan.loanStatus}">${loan.loanStatus}</span></td>
            <td>
              ${canManage ? `
                <div class="action-buttons">
                  <button class="btn btn-success btn-sm" onclick="approveLoan('${loan.__backendId}')">Accept</button>
                  <button class="btn btn-danger btn-sm" onclick="rejectLoan('${loan.__backendId}')">Reject</button>
                </div>
              ` : '-'}
            </td>
          </tr>
        `;
      }).join('');
    }

    function calculateLoanInterest() {
      const amount = parseFloat(document.getElementById('loanAmount').value) || 0;
      let interest = 0;
      
      if (amount <= 100) {
        interest = amount * 0.1;
      } else {
        interest = 100 * 0.1 + (amount - 100) * 0.2;
      }
      
      const total = amount + interest;
      
      document.getElementById('loanInterest').value = `${interest.toFixed(2)} RWF`;
      document.getElementById('loanTotal').value = `${total.toFixed(2)} RWF`;
    }

    async function handleLoanApplication(event) {
      event.preventDefault();
      const amount = parseFloat(document.getElementById('loanAmount').value);
      
      const activeLoans = allData.filter(d => d.__type === 'loan' && d.loanStatus === 'active');
      
      if (activeLoans.length >= 30) {
        showError('loanModalMessage', 'Maximum 30 active loans reached. Wait for a loan to be repaid.');
        return;
      }
      
      if (allData.filter(d => d.__type === 'loan').length >= 999) {
        showError('loanModalMessage', 'Maximum limit of 999 loan records reached');
        return;
      }
      
      const submitBtn = document.querySelector('#loanForm button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<span class="loading"></span>';
      
      let interest = 0;
      if (amount <= 100) {
        interest = amount * 0.1;
      } else {
        interest = 100 * 0.1 + (amount - 100) * 0.2;
      }
      
      const loan = {
        __type: 'loan',
        id: Date.now().toString(),
        loanAmount: amount,
        loanInterest: interest,
        loanFrom: currentUser.id,
        loanDate: new Date().toISOString(),
        loanStatus: 'pending'
      };
      
      const result = await window.dataSdk.create(loan);
      
      if (result.isOk) {
        await logActivity('loan_applied', `${currentUser.fullName} applied for loan of ${amount} RWF`);
        closeModal('loanModal');
        document.getElementById('loanForm').reset();
      }
      
      submitBtn.disabled = false;
      submitBtn.innerHTML = translations[currentLanguage].submitLoanBtn;
    }

    async function approveLoan(backendId) {
      const loan = allData.find(d => d.__backendId === backendId);
      if (!loan) return;
      
      loan.loanStatus = 'active';
      const result = await window.dataSdk.update(loan);
      
      if (result.isOk) {
        await logActivity('loan_approved', `Admin approved loan of ${loan.loanAmount} RWF`);
      }
    }

    async function rejectLoan(backendId) {
      const loan = allData.find(d => d.__backendId === backendId);
      if (!loan) return;
      
      loan.loanStatus = 'rejected';
      const result = await window.dataSdk.update(loan);
      
      if (result.isOk) {
        await logActivity('loan_rejected', `Admin rejected loan of ${loan.loanAmount} RWF`);
      }
    }

    // Chat
    function updateChatUsers() {
      const users = allData.filter(d => d.__type === 'user' && d.id !== currentUser.id);
      const chatUsersDiv = document.getElementById('chatUsers');
      
      if (users.length === 0) {
        chatUsersDiv.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üë•</div><p>No other members yet</p></div>';
        return;
      }
      
      chatUsersDiv.innerHTML = users.map(user => `
        <div class="chat-user ${selectedChatUser && selectedChatUser.id === user.id ? 'active' : ''}" onclick="selectChatUser('${user.id}')">
          <div class="chat-avatar">${user.profilePhoto}</div>
          <div>
            <div style="font-weight: 600;">${user.fullName}</div>
            <div style="font-size: 12px; opacity: 0.7;">${user.role}</div>
          </div>
        </div>
      `).join('');
    }

    function selectChatUser(userId) {
      const users = allData.filter(d => d.__type === 'user');
      selectedChatUser = users.find(u => u.id === userId);
      
      if (selectedChatUser) {
        document.getElementById('chatWithName').textContent = selectedChatUser.fullName;
        document.getElementById('messageInput').disabled = false;
        document.getElementById('sendMessageBtn').disabled = false;
        updateChatUsers();
        loadMessages();
      }
    }

    function loadMessages() {
      if (!selectedChatUser) return;
      
      const messages = allData.filter(d => 
        d.__type === 'message' && 
        ((d.messageFrom === currentUser.id && d.messageTo === selectedChatUser.id) ||
         (d.messageFrom === selectedChatUser.id && d.messageTo === currentUser.id))
      ).sort((a, b) => new Date(a.messageDate) - new Date(b.messageDate));
      
      const messagesDiv = document.getElementById('chatMessages');
      
      if (messages.length === 0) {
        messagesDiv.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üí¨</div><p>No messages yet. Start the conversation!</p></div>';
        return;
      }
      
      messagesDiv.innerHTML = messages.map(msg => {
        const isSent = msg.messageFrom === currentUser.id;
        const sender = isSent ? currentUser : selectedChatUser;
        
        return `
          <div class="message ${isSent ? 'sent' : ''}">
            <div class="chat-avatar">${sender.profilePhoto}</div>
            <div class="message-bubble">
              <div class="message-sender">${sender.fullName}</div>
              <div>${msg.messageText}</div>
              <div class="message-time">${new Date(msg.messageDate).toLocaleString()}</div>
            </div>
          </div>
        `;
      }).join('');
      
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    async function sendMessage() {
      const input = document.getElementById('messageInput');
      const text = input.value.trim();
      
      if (!text || !selectedChatUser) return;
      
      if (allData.filter(d => d.__type === 'message').length >= 999) {
        showError('chatMessages', 'Maximum limit of 999 messages reached');
        return;
      }
      
      const sendBtn = document.getElementById('sendMessageBtn');
      sendBtn.disabled = true;
      sendBtn.innerHTML = '<span class="loading"></span>';
      
      const message = {
        __type: 'message',
        id: Date.now().toString(),
        messageText: text,
        messageFrom: currentUser.id,
        messageTo: selectedChatUser.id,
        messageDate: new Date().toISOString()
      };
      
      const result = await window.dataSdk.create(message);
      
      if (result.isOk) {
        input.value = '';
        loadMessages();
      }
      
      sendBtn.disabled = false;
      sendBtn.innerHTML = translations[currentLanguage].sendMessageBtn;
    }

    // Audit
    function updateAuditTable() {
      const activities = allData.filter(d => d.__type === 'activity')
        .sort((a, b) => new Date(b.activityDate) - new Date(a.activityDate));
      const tbody = document.getElementById('auditTableBody');
      
      if (activities.length === 0) {
        tbody.innerHTML = '<tr><td colspan="3" class="empty-state"><div class="empty-state-icon">üìã</div><p>No activities yet</p></td></tr>';
        return;
      }
      
      tbody.innerHTML = activities.map(activity => `
        <tr>
          <td><span class="status-badge status-active">${activity.activityType}</span></td>
          <td>${activity.activityDescription}</td>
          <td>${new Date(activity.activityDate).toLocaleString()}</td>
        </tr>
      `).join('');
    }

    async function logActivity(type, description) {
      if (allData.filter(d => d.__type === 'activity').length >= 999) {
        return;
      }
      
      const activity = {
        __type: 'activity',
        id: Date.now().toString(),
        activityType: type,
        activityDescription: description,
        activityDate: new Date().toISOString()
      };
      
      await window.dataSdk.create(activity);
    }

    // Annual Report
    function updateAnnualReport() {
      const currentYear = new Date().getFullYear();
      const deposits = allData.filter(d => 
        d.__type === 'deposit' && 
        d.depositStatus === 'approved' &&
        new Date(d.depositDate).getFullYear() === currentYear
      );
      const loans = allData.filter(d => 
        d.__type === 'loan' && 
        new Date(d.loanDate).getFullYear() === currentYear
      );
      
      const totalDeposits = deposits.reduce((sum, d) => sum + (d.depositAmount || 0), 0);
      const totalLoans = loans.reduce((sum, l) => sum + (l.loanAmount || 0), 0);
      const totalInterest = loans.reduce((sum, l) => sum + (l.loanInterest || 0), 0);
      const activeLoans = loans.filter(l => l.loanStatus === 'active').length;
      
      const reportContent = document.getElementById('reportContent');
      reportContent.innerHTML = `
        <div style="padding: 40px; background: white; border-radius: 12px;">
          <h2 style="text-align: center; margin-bottom: 30px; color: #667eea;">Annual Financial Report ${currentYear}</h2>
          
          <div class="dashboard-grid" style="margin-bottom: 40px;">
            <div class="stat-card">
              <h3>Total Deposits</h3>
              <div class="stat-value">${totalDeposits.toLocaleString()} RWF</div>
              <div class="stat-label">${deposits.length} transactions</div>
            </div>
            <div class="stat-card">
              <h3>Total Loans</h3>
              <div class="stat-value">${totalLoans.toLocaleString()} RWF</div>
              <div class="stat-label">${loans.length} loans issued</div>
            </div>
            <div class="stat-card">
              <h3>Interest Earned</h3>
              <div class="stat-value">${totalInterest.toLocaleString()} RWF</div>
              <div class="stat-label">From loans</div>
            </div>
            <div class="stat-card">
              <h3>Active Loans</h3>
              <div class="stat-value">${activeLoans}</div>
              <div class="stat-label">Currently active</div>
            </div>
          </div>
          
          <div style="margin-top: 40px;">
            <h3 style="margin-bottom: 20px;">Summary</h3>
            <p style="line-height: 1.8; color: #6b7280;">
              During ${currentYear}, the Community Savings platform processed ${deposits.length} deposits totaling ${totalDeposits.toLocaleString()} RWF. 
              We issued ${loans.length} loans amounting to ${totalLoans.toLocaleString()} RWF, generating ${totalInterest.toLocaleString()} RWF in interest income. 
              Currently, ${activeLoans} loans remain active. The platform continues to serve our community effectively, promoting financial 
              inclusion and collaborative savings practices.
            </p>
          </div>
        </div>
      `;
    }

    function downloadReport() {
      const message = document.createElement('div');
      message.className = 'success-message';
      message.textContent = 'Report download functionality would generate a PDF file in a production environment.';
      document.getElementById('reportContent').insertBefore(message, document.getElementById('reportContent').firstChild);
      setTimeout(() => message.remove(), 3000);
    }

    function printReport() {
      window.print();
    }

    // Admin Panel
    function updateAdminPanel() {
      if (currentUser.role !== 'admin') return;
      
      const users = allData.filter(d => d.__type === 'user');
      const pendingMembers = users.filter(u => u.role === 'member' && !u.approved);
      const allMembers = users.filter(u => u.role === 'member');
      const admins = users.filter(u => u.role === 'admin');
      
      const adminContent = document.getElementById('adminContent');
      adminContent.innerHTML = `
        <div style="margin-bottom: 40px;">
          <h3 style="margin-bottom: 20px;">System Statistics</h3>
          <div class="dashboard-grid">
            <div class="stat-card">
              <h3>Total Members</h3>
              <div class="stat-value">${allMembers.length}</div>
            </div>
            <div class="stat-card">
              <h3>Pending Approvals</h3>
              <div class="stat-value">${pendingMembers.length}</div>
            </div>
            <div class="stat-card">
              <h3>Active Admins</h3>
              <div class="stat-value">${admins.length}/3</div>
            </div>
          </div>
        </div>
        
        <div style="margin-bottom: 40px;">
          <h3 style="margin-bottom: 20px;">Pending Member Approvals</h3>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Phone</th>
                  <th>Joined</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                ${pendingMembers.length === 0 ? 
                  '<tr><td colspan="5" class="empty-state"><p>No pending approvals</p></td></tr>' :
                  pendingMembers.map(member => `
                    <tr>
                      <td>${member.fullName}</td>
                      <td>${member.email}</td>
                      <td>${member.phone}</td>
                      <td>${new Date(member.createdAt).toLocaleDateString()}</td>
                      <td>
                        <div class="action-buttons">
                          <button class="btn btn-success btn-sm" onclick="approveMember('${member.__backendId}')">Approve</button>
                          <button class="btn btn-danger btn-sm" onclick="deleteMember('${member.__backendId}')">Reject</button>
                        </div>
                      </td>
                    </tr>
                  `).join('')
                }
              </tbody>
            </table>
          </div>
        </div>
        
        <div>
          <h3 style="margin-bottom: 20px;">All Members</h3>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                ${allMembers.map(member => `
                  <tr>
                    <td>${member.fullName}</td>
                    <td>${member.email}</td>
                    <td><span class="status-badge ${member.approved ? 'status-approved' : 'status-pending'}">${member.approved ? 'Approved' : 'Pending'}</span></td>
                    <td>
                      <button class="btn btn-danger btn-sm" onclick="deleteMember('${member.__backendId}')">Delete</button>
                    </td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          </div>
        </div>
        
        <div style="margin-top: 40px;">
          <h3 style="margin-bottom: 20px;">Admin Account Management</h3>
          <button class="btn btn-danger" onclick="deleteMyAccount()">Delete My Admin Account</button>
          <p style="margin-top: 10px; color: #6b7280; font-size: 14px;">
            This will allow another user to register as an admin (current: ${admins.length}/3)
          </p>
        </div>
      `;
    }

    async function approveMember(backendId) {
      const member = allData.find(d => d.__backendId === backendId);
      if (!member) return;
      
      member.approved = true;
      const result = await window.dataSdk.update(member);
      
      if (result.isOk) {
        await logActivity('member_approved', `Admin approved member ${member.fullName}`);
        updateAdminPanel();
      }
    }

    async function deleteMember(backendId) {
      const member = allData.find(d => d.__backendId === backendId);
      if (!member) return;
      
      const result = await window.dataSdk.delete(member);
      
      if (result.isOk) {
        await logActivity('member_deleted', `Admin deleted member ${member.email}`);
        updateAdminPanel();
      }
    }

    async function deleteMyAccount() {
      if (!currentUser || currentUser.role !== 'admin') return;
      
      const confirmDiv = document.createElement('div');
      confirmDiv.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); z-index: 1001;';
      confirmDiv.innerHTML = `
        <h3 style="margin-bottom: 15px;">Confirm Account Deletion</h3>
        <p style="margin-bottom: 20px; color: #6b7280;">Are you sure you want to delete your admin account? This action cannot be undone.</p>
        <div style="display: flex; gap: 10px;">
          <button class="btn btn-danger" onclick="confirmDeleteAccount()">Delete Account</button>
          <button class="btn btn-secondary" onclick="this.parentElement.parentElement.remove()">Cancel</button>
        </div>
      `;
      document.body.appendChild(confirmDiv);
    }

    async function confirmDeleteAccount() {
      const result = await window.dataSdk.delete(currentUser);
      
      if (result.isOk) {
        await logActivity('admin_deleted', `Admin ${currentUser.email} deleted their account`);
        logout();
      }
      
      document.querySelectorAll('body > div[style*="position: fixed"]').forEach(el => el.remove());
    }

    // Contact
    async function handleContact(event) {
      event.preventDefault();
      const name = document.getElementById('contactName').value;
      const email = document.getElementById('contactEmail').value;
      const phone = document.getElementById('contactPhone').value;
      const subject = document.getElementById('contactSubject').value;
      const message = document.getElementById('contactMessageText').value;
      
      if (allData.filter(d => d.__type === 'contact').length >= 999) {
        showError('contactMessage', 'Maximum limit of 999 contact messages reached');
        return;
      }
      
      const submitBtn = document.querySelector('#contactForm button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<span class="loading"></span>';
      
      const contact = {
        __type: 'contact',
        id: Date.now().toString(),
        contactName: name,
        contactEmail: email,
        contactPhone: phone,
        contactSubject: subject,
        contactMessage: message,
        contactDate: new Date().toISOString()
      };
      
      const result = await window.dataSdk.create(contact);
      
      if (result.isOk) {
        showSuccess('contactMessage', 'Thank you! Your message has been sent successfully.');
        document.getElementById('contactForm').reset();
      } else {
        showError('contactMessage', 'Failed to send message. Please try again.');
      }
      
      submitBtn.disabled = false;
      submitBtn.innerHTML = translations[currentLanguage].contactSubmitBtn;
    }

    // Language switcher
    document.getElementById('languageSelector').addEventListener('change', (e) => {
      currentLanguage = e.target.value;
      updateLanguage();
    });

    function updateLanguage() {
      const t = translations[currentLanguage];
      
      Object.keys(t).forEach(key => {
        const element = document.getElementById(key);
        if (element) {
          if (element.tagName === 'INPUT' || element.tagName === 'BUTTON') {
            if (element.type === 'submit' || element.tagName === 'BUTTON') {
              const textSpan = element.querySelector('span');
              if (textSpan) {
                textSpan.textContent = t[key];
              } else {
                element.textContent = t[key];
              }
            } else {
              element.placeholder = t[key];
            }
          } else {
            element.textContent = t[key];
          }
        }
      });
      
      updateAuthButtons();
    }

    // Utility functions
    function showModal(modalId) {
      document.getElementById(modalId).classList.add('active');
    }

    function closeModal(modalId) {
      document.getElementById(modalId).classList.remove('active');
    }

    function togglePassword(inputId) {
      const input = document.getElementById(inputId);
      input.type = input.type === 'password' ? 'text' : 'password';
    }

    function showError(elementId, message) {
      const element = document.getElementById(elementId);
      element.innerHTML = `<div class="error-message">${message}</div>`;
      setTimeout(() => element.innerHTML = '', 5000);
    }

    function showSuccess(elementId, message) {
      const element = document.getElementById(elementId);
      element.innerHTML = `<div class="success-message">${message}</div>`;
      setTimeout(() => element.innerHTML = '', 5000);
    }

    // Initialize app
    initializeApp();
  </script>
 </body>
</html>