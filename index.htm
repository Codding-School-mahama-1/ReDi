<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Money Management System</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"> -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
        body {
            box-sizing: border-box;
            height: 100%;
            margin: 0;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-x: hidden;
        }
        html {
            height: 100%;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .glass-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            background: rgba(255, 255, 255, 0.15);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
        }
        
        .hidden {
            display: none !important;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            color: white;
            font-weight: 500;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        }
        
        .notification.error {
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
        }

        /* Chat Styles */
        .message {
            max-width: 70%;
            padding: 0.75rem 1rem;
            border-radius: 1rem;
            margin-bottom: 0.5rem;
            word-wrap: break-word;
        }
        
        .message.sent {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 0.25rem;
        }
        
        .message.received {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border-bottom-left-radius: 0.25rem;
        }
        
        .message-time {
            font-size: 0.75rem;
            opacity: 0.7;
            margin-top: 0.25rem;
        }
        
        .voice-message {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .voice-wave {
            width: 100px;
            height: 20px;
            background: repeating-linear-gradient(
                90deg,
                rgba(255,255,255,0.3) 0px,
                rgba(255,255,255,0.3) 2px,
                transparent 2px,
                transparent 6px
            );
            border-radius: 10px;
        }

        .recording-pulse {
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .nav-btn.active {
            background: rgba(255, 255, 255, 0.2);
            border-left: 4px solid #fff;
        }

        .report-table {
            width: 100%;
            border-collapse: collapse;
        }

        .report-table th,
        .report-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .report-table th {
            background: rgba(255, 255, 255, 0.1);
            font-weight: 600;
        }

        @media print {
            body {
                background: white !important;
                color: black !important;
            }
            .glass-card {
                background: white !important;
                border: 1px solid #ccc !important;
                box-shadow: none !important;
            }
            .no-print {
                display: none !important;
            }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body><!-- Homepage Section -->
  <div id="homepageSection" class="min-h-full"><!-- Hero Section -->
   <header class="glass-effect p-6">
    <div class="max-w-7xl mx-auto flex flex-col sm:flex-row justify-between items-center gap-4">
     <div class="flex items-center space-x-4"><i class="fas fa-piggy-bank text-3xl text-white"></i>
      <h1 class="text-2xl font-bold text-white">CB</h1>
     </div>
     <div class="flex flex-col sm:flex-row items-center gap-4"><!-- Language Selector -->
      <div class="flex items-center space-x-2"><i class="fas fa-globe text-white opacity-80"></i> <select id="languageSelector" onchange="changeLanguage()" class="px-3 py-2 rounded-lg bg-white bg-opacity-20 border border-white border-opacity-30 text-white text-sm focus:outline-none focus:ring-2 focus:ring-white focus:ring-opacity-50"> <option value="en" class="text-black">English</option> <option value="ar" class="text-black">العربية (Arabic)</option> <option value="sw" class="text-black">Kiswahili</option> <option value="rw" class="text-black">Kinyarwanda</option> </select>
      </div>
      <div class="flex space-x-4"><button onclick="showAuthSection()" class="btn-primary text-white px-6 py-3 rounded-lg font-semibold"> <i class="fas fa-sign-in-alt mr-2"></i><span data-translate="login">Login</span> </button> <button onclick="showAuthSection('signup')" class="glass-effect text-white px-6 py-3 rounded-lg font-semibold border border-white border-opacity-30 hover:bg-white hover:bg-opacity-20"> <i class="fas fa-user-plus mr-2"></i><span data-translate="signup">Sign Up</span> </button>
      </div>
     </div>
    </div>
   </header>






   
   <div>
    <div>
     <h2>Take Control of Your Financial Future</h2>
     <p>Join our community-driven money management platform where members save together, support each other through loans, and build wealth through annual cashouts.</p><button onclick="showAuthSection('signup')"> <i class="fas fa-rocket"></i>Start Your Journey </button>
    </div>
    <div>
     <div><i class="fas fa-piggy-bank"></i>
      <h3>Smart Savings</h3>
      <p>Set personalized savings goals and track your progress with our intuitive tools.</p>
     </div>
     <div><i class="fas fa-handshake"></i>
      <h3>Community Loans</h3>
      <p>Access affordable loans from the community fund with competitive interest rates.</p>
     </div>
     <div><i class="fas fa-chart-line"></i>
      <h3>Annual Cashouts</h3>
      <p>Receive annual returns based on your savings, deposits, and community participation.</p>
     </div>
     <div><i class="fas fa-shield-alt"></i>
      <h3>Secure Platform</h3>
      <p>Your financial data is protected with bank-level security and encryption.</p>
     </div>
    </div>
    <div>
     <h3>How MoneyWise Works</h3>
     <div>
      <div>
       <div><span>1</span>
       </div>
       <h4>Join &amp; Deposit</h4>
       <p>Create your account and make your first deposit to start building your financial foundation.</p>
      </div>
      <div>
       <div><span>2</span>
       </div>
       <h4>Save &amp; Grow</h4>
       <p>Set savings goals, make regular deposits, and watch your money grow throughout the year.</p>
      </div>
      <div>
       <div><span>3</span>
       </div>
       <h4>Annual Rewards</h4>
       <p>Receive your annual cashout based on your total contributions and community participation.</p>
      </div>
     </div>
    </div>
    <div>
     <div>
      <h3>Why Choose MoneyWise?</h3>
      <div>
       <div><i class="fas fa-check-circle"></i>
        <div>
         <h4>Community-Driven</h4>
         <p>Built by the community, for the community. Every member has a voice.</p>
        </div>
       </div>
       <div><i class="fas fa-check-circle"></i>
        <div>
         <h4>Transparent Fees</h4>
         <p>No hidden charges. Clear, upfront pricing for all services.</p>
        </div>
       </div>
       <div><i class="fas fa-check-circle"></i>
        <div>
         <h4>Flexible Terms</h4>
         <p>Customize your savings and loan terms to fit your lifestyle.</p>
        </div>
       </div>
       <div><i class="fas fa-check-circle"></i>
        <div>
         <h4>24/7 Support</h4>
         <p>Get help whenever you need it through our member chat system.</p>
        </div>
       </div>
      </div>
     </div>
     <div>
      <h4>Ready to Get Started?</h4>
      <p>Join thousands of members who are already building their financial future with MoneyWise. Start with as little as $10 and watch your money grow.</p>
      <div><button onclick="showAuthSection('signup')"> <i class="fas fa-user-plus"></i>Create Free Account </button> <button onclick="showAuthSection()"> <i class="fas fa-sign-in-alt"></i>Already a Member? Login </button>
      </div>
     </div>
    </div>
   </div>
   <footer>
    <div>
     <div><i class="fas fa-piggy-bank"></i>
      <h3>MoneyWise</h3>
     </div>
     <p>Building financial futures together, one member at a time.</p>
     <div><a href="#">Privacy Policy</a> <a href="#">Terms of Service</a> <a href="#">Contact Us</a>
     </div>
     <p>© 2024 MoneyWise. All rights reserved.</p>
    </div>
   </footer>
  </div>
  <div id="authSection">
   <div>
    <div><button onclick="showHomepage()"> <i class="fas fa-arrow-left"></i>Back to Homepage </button> <i class="fas fa-piggy-bank"></i>
     <h2>Money Management System</h2>
     <p>Secure your financial future</p>
    </div>
    <div id="loginForm">
     <h3>Sign In</h3>
     <form onsubmit="handleLogin(event)">
      <div>
       <div><label for="loginEmail">Email</label> <input type="email" id="loginEmail" required placeholder="Enter your email">
       </div>
       <div><label for="loginPassword">Password</label> <input type="password" id="loginPassword" required placeholder="Enter your password">
       </div>
       <div><label> <input type="checkbox"> <span>Remember me</span> </label> <button type="button">Forgot password?</button>
       </div><button type="submit"> Sign In </button>
      </div>
     </form>
     <div>
      <p>Don't have an account? <button onclick="showSignup()">Sign up</button></p>
     </div>
     <div>
      <div><i class="fas fa-crown"></i>
       <h4>Admin Management</h4>
       <p>Create or login to admin account</p>
      </div>
      <div><button onclick="createAdminAccount()"> <i class="fas fa-user-shield"></i>Create Admin Account </button>
       <div>
        <p>Default Admin Login:</p>
        <p>admin@system.com / admin123</p>
       </div><button onclick="loginAsAdmin()"> Quick Admin Login </button>
      </div>
     </div>
    </div>
    <div id="signupForm" class="hidden">
     <h3>Create Account</h3>
     <form onsubmit="handleSignup(event)">
      <div>
       <div>
        <div><label for="firstName">First Name</label> <input type="text" id="firstName" required placeholder="First name">
        </div>
        <div><label for="lastName">Last Name</label> <input type="text" id="lastName" required placeholder="Last name">
        </div>
       </div>
       <div><label for="signupEmail">Email</label> <input type="email" id="signupEmail" required placeholder="Enter your email">
       </div>
       <div><label for="signupPassword">Password</label> <input type="password" id="signupPassword" required placeholder="Create password">
       </div>
       <div><label for="confirmPassword">Confirm Password</label> <input type="password" id="confirmPassword" required placeholder="Confirm password">
       </div><button type="submit"> Create Account </button>
      </div>
     </form>
     <div>
      <p>Already have an account? <button onclick="showLogin()">Sign in</button></p>
     </div>
    </div>
   </div>
  </div>
  <div id="dashboard" class="hidden">
   <header>
    <div>
     <div><i class="fas fa-piggy-bank"></i>
      <h1>Money Management</h1>
     </div>
     <div><span id="userWelcome"></span> <button onclick="logout()"> <i class="fas fa-sign-out-alt"></i> Logout </button>
     </div>
    </div>
   </header>
   <div>
    <div><button onclick="toggleMobileMenu()"> <i id="menuIcon" class="fas fa-bars"></i> </button>
    </div>
    <aside id="sidebar">
     <div><button onclick="toggleMobileMenu()"> <i class="fas fa-times"></i> </button>
     </div>
     <nav><button onclick="showSection('overview')" class="nav-btn"> <i class="fas fa-chart-pie"></i>Overview </button> <button onclick="showSection('deposits')" class="nav-btn"> <i class="fas fa-coins"></i>Deposits </button> <button onclick="showSection('loans')" class="nav-btn"> <i class="fas fa-hand-holding-usd"></i>Loans </button>
      <div id="adminCashoutMenu" class="hidden"><button onclick="showSection('cashout')" class="nav-btn"> <i class="fas fa-money-bill-wave"></i>Cashout Management </button>
      </div><button onclick="showSection('summary')" class="nav-btn"> <i class="fas fa-chart-line"></i>My Summary </button> <button onclick="showSection('chat')" class="nav-btn"> <i class="fas fa-comments"></i>Member Chat </button>
      <div id="adminMenu" class="hidden"><button onclick="showSection('audit')" class="nav-btn"> <i class="fas fa-search"></i>Audit Dashboard </button> <button onclick="showSection('reports')" class="nav-btn"> <i class="fas fa-file-alt"></i>Annual Reports </button> <button onclick="showSection('admin')" class="nav-btn"> <i class="fas fa-cog"></i>Admin Panel </button>
      </div>
     </nav>
    </aside>
    <div id="sidebarOverlay" onclick="toggleMobileMenu()"></div>
    <main>
     <div id="overviewSection" class="section">
      <h2>Financial Overview</h2>
      <div>
       <div>
        <div>
         <div>
          <p>Total Balance</p>
          <p id="totalBalance">$0.00</p>
         </div><i class="fas fa-wallet"></i>
        </div>
       </div>
       <div>
        <div>
         <div>
          <p>Total Savings</p>
          <p id="totalSavings">$0.00</p>
         </div><i class="fas fa-piggy-bank"></i>
        </div>
       </div>
       <div>
        <div>
         <div>
          <p>Active Loans</p>
          <p id="totalLoans">$0.00</p>
         </div><i class="fas fa-hand-holding-usd"></i>
        </div>
       </div>
       <div>
        <div>
         <div>
          <p>Annual Cashout</p>
          <p id="annualCashout">$0.00</p>
         </div><i class="fas fa-calendar-check"></i>
        </div>
       </div>
      </div>
     </div>
     <div id="savingsSection" class="section hidden">
      <div>
       <h2>Savings Accounts</h2><button onclick="showAddSavingsModal()"> <i class="fas fa-plus"></i>Add Savings Goal </button>
      </div>
      <div id="savingsList">
       </div>
     </div>
     <div id="depositsSection" class="section hidden">
      <div>
       <h2>Deposits</h2>
       <div id="memberDepositButton"><button onclick="showDepositModal()"> <i class="fas fa-plus"></i>Make Deposit </button>
       </div>
       <div id="adminDepositButton" class="hidden"><button onclick="showDepositModal()"> <i class="fas fa-plus"></i>Register Deposit </button>
       </div>
      </div>
      <div id="adminDepositsView" class="hidden">
       <div>
        <h3>All Member Deposits</h3>
        <div>
         <table class="report-table">
          <thead>
           <tr>
            <th>Date</th>
            <th>Member Name</th>
            <th>Phone Number</th>
            <th>Amount</th>
            <th>Description</th>
            <th>Status</th>
            <th>Actions</th>
           </tr>
          </thead>
          <tbody id="adminDepositsTable">
           </tbody>
         </table>
        </div>
       </div>
       <div>
        <div>
         <h4>Today's Deposits</h4>
         <p id="todayDeposits">$0.00</p>
         <p>From <span id="todayDepositCount">0</span> members</p>
        </div>
        <div>
         <h4>This Month</h4>
         <p id="monthDeposits">$0.00</p>
         <p>From <span id="monthDepositCount">0</span> deposits</p>
        </div>
        <div>
         <h4>Total This Year</h4>
         <p id="yearDeposits">$0.00</p>
         <p>From <span id="yearDepositCount">0</span> deposits</p>
        </div>
       </div>
      </div>
      <div id="memberDepositsView">
       <h3>My Deposits</h3>
       <div id="depositsList">
        </div>
      </div>
     </div>
     <div id="loansSection" class="section hidden">
      <div>
       <h2>Loans</h2>
       <div id="memberLoanButton"><button onclick="showLoanModal()"> <i class="fas fa-plus"></i>Apply for Loan </button>
       </div>
      </div>
      <div id="loansList">
       </div>
     </div>
     <div id="cashoutSection" class="section hidden">
      <div>
       <h2>Annual Cashout</h2>
       <div><select id="cashoutYear" onchange="calculateAnnualCashout()">
         <option value="2024">2024</option>
         <option value="2023">2023</option>
         <option value="2022">2022</option>
        </select> <button onclick="processCashoutRequest()"> <i class="fas fa-money-bill-wave"></i>Request Cashout </button>
       </div>
      </div>
      <div>
       <div>
        <h3>Cashout Calculation</h3>
        <div>
         <div><span>Total Savings:</span> <span id="totalSavingsAmount">$0.00</span>
         </div>
         <div><span>Total Deposits:</span> <span id="totalDepositsAmount">$0.00</span>
         </div>
         <div><span>Loan Payments Made:</span> <span id="loanPaymentsAmount">$0.00</span>
         </div>
         <div>
          <div><span>Community Fund Share (5% of Total):</span> <span id="communityFundShare">$0.00</span>
          </div>
         </div>
         <div>
          <div><span>Total Deductions/Fees:</span> <span id="totalDeductionsAmount">$0.00</span>
          </div>
         </div>
         <div>
          <div><span>Final Cashout Amount:</span> <span id="finalCashoutAmount">$0.00</span>
          </div>
         </div>
        </div>
       </div>
       <div>
        <h3>Cashout History</h3>
        <div id="cashoutHistoryList">
         <div>
          <div>
           <p>2023 Annual Cashout</p>
           <p>15 Dec 2023</p>
          </div>
          <div>
           <p>$1,500.00</p><span class="text-xs">Paid</span>
          </div>
         </div>
         <div>
          <div>
           <p>2022 Annual Cashout</p>
           <p>18 Dec 2022</p>
          </div>
          <div>
           <p>$1,200.00</p><span class="text-xs">Paid</span>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <div id="summarySection" class="section hidden">
      <h2>My Financial Summary</h2>
      <div>
       <div>
        <div>
         <h4>Net Worth Projection</h4>
         <p id="netWorth">$0.00</p>
        </div><i class="fas fa-chart-bar"></i>
       </div>
       <div>
        <div>
         <h4>Savings Rate</h4>
         <p id="savingsRate">0%</p>
        </div><i class="fas fa-percent"></i>
       </div>
       <div>
        <div>
         <h4>Loan Repayment Progress</h4>
         <p id="loanProgress">0%</p>
        </div><i class="fas fa-sync-alt"></i>
       </div>
       <div>
        <div>
         <h4>Goal Completion</h4>
         <p id="goalCompletion">0/0</p>
        </div><i class="fas fa-bullseye"></i>
       </div>
      </div>
      <div>
       <h3>Detailed Reports</h3>
       <div><button onclick="generatePdfReport()"> <i class="fas fa-file-pdf"></i>Download Full Report (PDF) </button> <button onclick="printReport()"> <i class="fas fa-print"></i>Print Summary </button>
       </div>
      </div>
     </div>
     <div id="chatSection" class="section hidden">
      <h2>Member Chat Support</h2>
      <div>
       <div id="chatBox">
        </div>
       <form onsubmit="sendChatMessage(event)">
        <div><input type="text" id="chatInput" placeholder="Type your message..." required> <button type="submit"> <i class="fas fa-paper-plane"></i> </button>
         <div><button type="button" onclick="startRecording()"> <i class="fas fa-microphone"></i> </button>
         </div>
        </div>
       </form>
      </div>
     </div>
     <div id="auditSection" class="section hidden">
      <h2>Audit Dashboard</h2>
      <div>
       <div>
        <h3>Recent Transactions &amp; Events</h3>
        <div>
         <table class="report-table">
          <thead>
           <tr>
            <th>Timestamp</th>
            <th>User</th>
            <th>Type</th>
            <th>Amount</th>
            <th>Details</th>
           </tr>
          </thead>
          <tbody id="auditLogTable">
           </tbody>
         </table>
        </div>
       </div>
      </div>
     </div>
     <div id="reportsSection" class="section hidden">
      <h2>Annual Reports</h2>
      <div>
       <div>
        <h3>Community Financial Health</h3>
        <div>
         <div>
          <h4>Total Community Fund</h4>
          <p id="communityFundTotal">$0.00</p>
         </div>
         <div>
          <h4>Total Loans Granted</h4>
          <p id="loansGrantedTotal">$0.00</p>
         </div>
         <div>
          <h4>Total Members</h4>
          <p id="totalMembers">0</p>
         </div>
        </div>
       </div>
       <div>
        <h3>Generate Community Report</h3><select id="reportYear">
         <option value="2024">2024</option>
         <option value="2023">2023</option>
         <option value="2022">2022</option>
        </select> <button onclick="generateCommunityReport()"> <i class="fas fa-chart-bar"></i>Generate Report </button>
       </div>
      </div>
     </div>
     <div id="adminSection" class="section hidden">
      <h2>Admin Panel</h2>
      <div>
       <div>
        <h3>User Management</h3>
        <div>
         <table class="report-table">
          <thead>
           <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Balance</th>
            <th>Loans Due</th>
            <th>Actions</th>
           </tr>
          </thead>
          <tbody id="userManagementTable">
           </tbody>
         </table>
        </div>
       </div>
       <div>
        <h3>System Settings</h3>
        <div>
         <div><label for="interestRate">Loan Interest Rate (%)</label> <input type="number" id="interestRate" value="5" min="0" max="100">
         </div>
         <div><label for="cashoutRate">Annual Cashout Rate (%)</label> <input type="number" id="cashoutRate" value="5" min="0" max="100">
         </div><button onclick="saveSettings()">Save Settings</button>
        </div>
       </div>
      </div>
     </div>
    </main>
   </div>
  </div>
  <div id="notification" class="hidden"></div>
  
  <script>
    // --- Data Management and State ---
    const MOCK_ADMIN = { email: 'admin@system.com', password: 'admin123', is_admin: true, name: 'Admin User' };
    let users = JSON.parse(localStorage.getItem('moneyWiseUsers')) || [MOCK_ADMIN];
    let currentUser = JSON.parse(localStorage.getItem('moneyWiseCurrentUser')) || null;
    let transactions = JSON.parse(localStorage.getItem('moneyWiseTransactions')) || [];
    let loans = JSON.parse(localStorage.getItem('moneyWiseLoans')) || [];
    let chatMessages = JSON.parse(localStorage.getItem('moneyWiseChat')) || [];

    const saveState = () => {
        localStorage.setItem('moneyWiseUsers', JSON.stringify(users));
        localStorage.setItem('moneyWiseTransactions', JSON.stringify(transactions));
        localStorage.setItem('moneyWiseLoans', JSON.stringify(loans));
        localStorage.setItem('moneyWiseCurrentUser', JSON.stringify(currentUser));
        localStorage.setItem('moneyWiseChat', JSON.stringify(chatMessages));
    };

    // --- Utility Functions ---

    /**
     * Shows a transient notification message.
     * @param {string} message - The message content.
     * @param {('success'|'error')} type - The type of notification.
     */
    const showNotification = (message, type) => {
        let notification = document.getElementById('notification');
        if (!notification) {
            notification = document.createElement('div');
            notification.id = 'notification';
            document.body.appendChild(notification);
        }
        notification.className = `notification ${type}`;
        notification.textContent = message;
        setTimeout(() => notification.classList.add('show'), 10);
        setTimeout(() => notification.classList.remove('show'), 3000);
    };

    const formatCurrency = (amount) => {
        return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(amount);
    };

    const getMemberNameById = (userId) => {
        const user = users.find(u => u.email === userId);
        return user ? `${user.firstName} ${user.lastName}` : 'System User';
    };

    // --- Authentication and Navigation ---

    const showHomepage = () => {
        document.getElementById('homepageSection').classList.remove('hidden');
        document.getElementById('authSection').classList.add('hidden');
        document.getElementById('dashboard').classList.add('hidden');
    };

    const showAuthSection = (mode = 'login') => {
        document.getElementById('homepageSection').classList.add('hidden');
        document.getElementById('authSection').classList.remove('hidden');
        showLogin();
        if (mode === 'signup') {
            showSignup();
        }
    };

    const showLogin = () => {
        document.getElementById('loginForm').classList.remove('hidden');
        document.getElementById('signupForm').classList.add('hidden');
    };

    const showSignup = () => {
        document.getElementById('loginForm').classList.add('hidden');
        document.getElementById('signupForm').classList.remove('hidden');
    };

    const loginUser = (user) => {
        currentUser = user;
        localStorage.setItem('moneyWiseCurrentUser', JSON.stringify(currentUser));
        document.getElementById('authSection').classList.add('hidden');
        document.getElementById('dashboard').classList.remove('hidden');
        document.getElementById('userWelcome').textContent = `Welcome, ${currentUser.firstName || currentUser.name}!`;
        initializeDashboard();
        showSection('overview');
    };

    const handleLogin = (event) => {
        event.preventDefault();
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;

        const user = users.find(u => u.email === email && u.password === password);

        if (user) {
            loginUser(user);
            showNotification('Login successful!', 'success');
        } else {
            showNotification('Invalid email or password.', 'error');
        }
    };

    const handleSignup = (event) => {
        event.preventDefault();
        const firstName = document.getElementById('firstName').value;
        const lastName = document.getElementById('lastName').value;
        const email = document.getElementById('signupEmail').value;
        const password = document.getElementById('signupPassword').value;
        const confirmPassword = document.getElementById('confirmPassword').value;

        if (password !== confirmPassword) {
            showNotification('Passwords do not match.', 'error');
            return;
        }

        if (users.some(u => u.email === email)) {
            showNotification('An account with this email already exists.', 'error');
            return;
        }

        const newUser = {
            id: Date.now(),
            firstName,
            lastName,
            email,
            password,
            is_admin: false,
            balance: 0,
            savings: 0,
            loans_due: 0,
            loan_applications: [],
            deposits: [],
            savings_goals: []
        };

        users.push(newUser);
        saveState();
        showNotification('Account created successfully! Please sign in.', 'success');
        showLogin();
    };

    const loginAsAdmin = () => {
        const adminUser = users.find(u => u.email === MOCK_ADMIN.email && u.password === MOCK_ADMIN.password);
        if (adminUser) {
            loginUser(adminUser);
            showNotification('Logged in as Admin.', 'success');
        } else {
             // Should not happen if MOCK_ADMIN is correctly initialized
            showNotification('Admin account not found.', 'error');
        }
    };

    const createAdminAccount = () => {
        if (!users.some(u => u.email === MOCK_ADMIN.email)) {
            users.push(MOCK_ADMIN);
            saveState();
            showNotification('Admin account created successfully.', 'success');
        } else {
            showNotification('Admin account already exists.', 'error');
        }
    };

    const logout = () => {
        currentUser = null;
        localStorage.removeItem('moneyWiseCurrentUser');
        showHomepage();
        showNotification('Logged out successfully.', 'success');
    };

    // --- Dashboard Navigation and Initialization ---

    const toggleMobileMenu = () => {
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('sidebarOverlay');
        const menuIcon = document.getElementById('menuIcon');

        if (sidebar.classList.contains('-translate-x-full')) {
            sidebar.classList.remove('-translate-x-full');
            overlay.classList.remove('hidden');
            menuIcon.classList.remove('fa-bars');
            menuIcon.classList.add('fa-times');
        } else {
            sidebar.classList.add('-translate-x-full');
            overlay.classList.add('hidden');
            menuIcon.classList.remove('fa-times');
            menuIcon.classList.add('fa-bars');
        }
    };

    const showSection = (sectionId) => {
        document.querySelectorAll('.section').forEach(section => {
            section.classList.add('hidden');
        });

        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.classList.remove('active');
        });

        const targetSection = document.getElementById(`${sectionId}Section`);
        if (targetSection) {
            targetSection.classList.remove('hidden');
            // Set active class on the button
            const activeBtn = document.querySelector(`[onclick="showSection('${sectionId}')"]`);
            if (activeBtn) activeBtn.classList.add('active');
        }
        
        // Hide mobile menu after selection
        if (window.innerWidth < 1024) {
            toggleMobileMenu();
        }

        // Call specific update function for the section
        switch (sectionId) {
            case 'overview':
                updateOverview();
                break;
            case 'deposits':
                updateDepositsSection();
                break;
            case 'loans':
                updateLoansSection();
                break;
            case 'cashout':
                calculateAnnualCashout(); // Default to current year
                break;
            case 'summary':
                // updateSummary();
                break;
            case 'chat':
                loadChatMessages();
                break;
            case 'audit':
                // updateAuditDashboard();
                break;
            case 'reports':
                // updateReports();
                break;
            case 'admin':
                // updateAdminPanel();
                break;
        }
    };

    const initializeDashboard = () => {
        // Show/Hide Admin menu items
        const isAdmin = currentUser.is_admin;
        document.getElementById('adminMenu').classList.toggle('hidden', !isAdmin);
        document.getElementById('adminCashoutMenu').classList.toggle('hidden', !isAdmin);

        // Deposits section specific elements
        document.getElementById('memberDepositButton').classList.toggle('hidden', isAdmin);
        document.getElementById('adminDepositButton').classList.toggle('hidden', !isAdmin);
        document.getElementById('adminDepositsView').classList.toggle('hidden', !isAdmin);
        document.getElementById('memberDepositsView').classList.toggle('hidden', isAdmin);

        // Update display name
        document.getElementById('userWelcome').textContent = `Welcome, ${currentUser.firstName || currentUser.name}!`;

        // Load initial data
        updateOverview();
    };

    // --- Overview Logic ---

    const updateOverview = () => {
        if (!currentUser) return;

        // Recalculate balances from transactions (mock for simplicity)
        const userTransactions = transactions.filter(t => t.userId === currentUser.email);
        const totalDeposits = userTransactions.filter(t => t.type === 'deposit').reduce((sum, t) => sum + t.amount, 0);
        const totalLoanPayments = userTransactions.filter(t => t.type === 'loan_payment').reduce((sum, t) => sum + t.amount, 0);
        
        // Mock Savings Goal calculation (Total deposits for now)
        const totalSavings = totalDeposits;

        // Mock Loan calculation (Total active loan amount)
        const activeLoans = loans.filter(l => l.userId === currentUser.email && l.status === 'approved');
        const totalLoansDue = activeLoans.reduce((sum, l) => sum + l.amount - l.paid, 0);

        currentUser.balance = totalDeposits - totalLoansDue;
        currentUser.savings = totalSavings;
        currentUser.loans_due = totalLoansDue;
        
        // Mock Annual Cashout (2% of total savings + deposits)
        const mockCashout = (totalSavings * 0.02) + (totalDeposits * 0.02); 

        document.getElementById('totalBalance').textContent = formatCurrency(currentUser.balance);
        document.getElementById('totalSavings').textContent = formatCurrency(currentUser.savings);
        document.getElementById('totalLoans').textContent = formatCurrency(currentUser.loans_due);
        document.getElementById('annualCashout').textContent = formatCurrency(mockCashout);

        saveState();
    };

    // --- Deposits Logic ---

    const showDepositModal = (isEditing = false, transaction = null) => {
        // Implementation for the modal to add/register a deposit (omitted for brevity)
        // This function would typically display a hidden modal and populate it with form data.
        showNotification('Deposit modal opened. (Implementation required for full form functionality)', 'success');
    };

    const updateDepositsSection = () => {
        if (!currentUser) return;

        if (currentUser.is_admin) {
            // Admin View: All deposits
            const adminTableBody = document.getElementById('adminDepositsTable');
            adminTableBody.innerHTML = '';

            const allDeposits = transactions.filter(t => t.type === 'deposit').sort((a, b) => new Date(b.date) - new Date(a.date));

            let todayTotal = 0;
            let thisMonthTotal = 0;
            let thisYearTotal = 0;
            let todayCount = 0;
            let monthCount = 0;
            let yearCount = 0;
            const now = new Date();

            allDeposits.forEach(deposit => {
                const depositDate = new Date(deposit.date);

                if (depositDate.toDateString() === now.toDateString()) {
                    todayTotal += deposit.amount;
                    todayCount++;
                }
                if (depositDate.getMonth() === now.getMonth() && depositDate.getFullYear() === now.getFullYear()) {
                    thisMonthTotal += deposit.amount;
                    monthCount++;
                }
                if (depositDate.getFullYear() === now.getFullYear()) {
                    thisYearTotal += deposit.amount;
                    yearCount++;
                }

                const memberName = getMemberNameById(deposit.userId);
                const phoneNumber = users.find(u => u.email === deposit.userId)?.phoneNumber || 'N/A'; // Mock phone number

                adminTableBody.innerHTML += `
                    <tr>
                        <td>${deposit.date}</td>
                        <td>${memberName}</td>
                        <td>${phoneNumber}</td>
                        <td class="${deposit.type === 'loan_payment' ? 'text-orange-300' : 'text-green-300'}">${formatCurrency(deposit.amount)}</td>
                        <td>${deposit.description}</td>
                        <td><span class="px-2 py-1 text-xs font-semibold rounded-full ${deposit.status === 'Confirmed' ? 'bg-green-600' : 'bg-yellow-600'} text-white">${deposit.status}</span></td>
                        <td>
                            <button onclick="approveDeposit('${deposit.id}')" class="text-green-400 hover:text-green-300 mr-2"><i class="fas fa-check"></i></button>
                            <button onclick="deleteTransaction('${deposit.id}')" class="text-red-400 hover:text-red-300"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>
                `;
            });

            document.getElementById('todayDeposits').textContent = formatCurrency(todayTotal);
            document.getElementById('todayDepositCount').textContent = todayCount;
            document.getElementById('monthDeposits').textContent = formatCurrency(thisMonthTotal);
            document.getElementById('monthDepositCount').textContent = monthCount;
            document.getElementById('yearDeposits').textContent = formatCurrency(thisYearTotal);
            document.getElementById('yearDepositCount').textContent = yearCount;

        } else {
            // Member View: Personal deposits
            const depositsList = document.getElementById('depositsList');
            depositsList.innerHTML = '';

            const personalDeposits = transactions
                .filter(t => t.userId === currentUser.email && t.type === 'deposit')
                .sort((a, b) => new Date(b.date) - new Date(a.date));

            if (personalDeposits.length === 0) {
                depositsList.innerHTML = '<p class="text-white opacity-80 p-4 text-center">No deposits found. Make your first deposit!</p>';
            } else {
                personalDeposits.forEach(deposit => {
                    depositsList.innerHTML += `
                        <div class="glass-effect p-4 rounded-xl flex justify-between items-center transition-all hover:bg-opacity-20 fade-in">
                            <div class="flex items-center space-x-4">
                                <i class="fas fa-money-bill-wave text-2xl ${deposit.status === 'Confirmed' ? 'text-green-400' : 'text-yellow-400'}"></i>
                                <div>
                                    <p class="text-white font-semibold">${deposit.description}</p>
                                    <p class="text-white opacity-60 text-sm">${deposit.date}</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="text-lg font-bold ${deposit.status === 'Confirmed' ? 'text-green-400' : 'text-yellow-400'}">${formatCurrency(deposit.amount)}</p>
                                <span class="text-xs font-semibold px-2 py-0.5 rounded-full ${deposit.status === 'Confirmed' ? 'bg-green-600' : 'bg-yellow-600'} text-white">${deposit.status}</span>
                            </div>
                        </div>
                    `;
                });
            }
        }
    };

    const approveDeposit = (id) => {
        const depositIndex = transactions.findIndex(t => t.id === id);
        if (depositIndex !== -1) {
            transactions[depositIndex].status = 'Confirmed';
            saveState();
            updateDepositsSection();
            updateOverview(); // Recalculate balance
            showNotification('Deposit approved and confirmed.', 'success');
        }
    };

    const deleteTransaction = (id) => {
        transactions = transactions.filter(t => t.id !== id);
        saveState();
        updateDepositsSection();
        updateOverview();
        showNotification('Transaction deleted.', 'error');
    };
    
    // Mock function to add a deposit from a user
    const mockAddDeposit = (userId, amount, description = 'Regular Monthly Deposit') => {
        transactions.push({
            id: Date.now().toString(),
            userId: userId,
            type: 'deposit',
            amount: amount,
            description: description,
            date: new Date().toLocaleDateString('en-US'),
            status: 'Pending'
        });
        saveState();
        updateOverview();
    };
    
    // --- Loans Logic ---

    const showLoanModal = () => {
        // Implementation for the modal to apply for a loan (omitted for brevity)
        showNotification('Loan application modal opened. (Implementation required for full form functionality)', 'success');
    };

    const updateLoansSection = () => {
        if (!currentUser) return;

        const loansList = document.getElementById('loansList');
        loansList.innerHTML = '';

        const personalLoans = loans.filter(l => l.userId === currentUser.email).sort((a, b) => new Date(b.date) - new Date(a.date));
        
        if (personalLoans.length === 0) {
            loansList.innerHTML = '<p class="text-white opacity-80 p-4 text-center">No loan applications found. Apply for a loan today!</p>';
            return;
        }

        personalLoans.forEach(loan => {
            const statusColor = loan.status === 'approved' ? 'bg-green-600' : (loan.status === 'pending' ? 'bg-yellow-600' : 'bg-red-600');
            const totalDue = loan.amount - loan.paid;

            loansList.innerHTML += `
                <div class="glass-card p-6 rounded-xl flex flex-col md:flex-row justify-between items-start md:items-center transition-all hover:bg-opacity-20 fade-in">
                    <div class="space-y-2 mb-4 md:mb-0">
                        <p class="text-xl font-bold text-white">Loan for: ${loan.purpose}</p>
                        <p class="text-white opacity-80 text-sm">Amount: ${formatCurrency(loan.amount)} | Date: ${loan.date}</p>
                        <p class="text-white opacity-80 text-sm">Repayment Term: ${loan.term} months</p>
                    </div>
                    <div class="text-right space-y-2">
                        <p class="text-lg font-bold text-orange-400">Balance Due: ${formatCurrency(totalDue)}</p>
                        <span class="text-xs font-semibold px-2 py-0.5 rounded-full ${statusColor} text-white">${loan.status.toUpperCase()}</span>
                        <div class="mt-2">
                            ${loan.status === 'approved' ? `<button onclick="showPaymentModal('${loan.id}')" class="btn-primary text-white text-sm px-3 py-1 rounded-lg">Make Payment</button>` : ''}
                        </div>
                    </div>
                </div>
            `;
        });
    };

    const showPaymentModal = (loanId) => {
        // Implementation for loan payment modal (omitted for brevity)
        showNotification(`Payment modal for Loan ID: ${loanId} opened. (Implementation required for full payment logic)`, 'success');
    };

    // Mock function to add a loan application
    const mockAddLoan = (userId, amount, purpose, term) => {
        loans.push({
            id: Date.now().toString(),
            userId: userId,
            amount: amount,
            purpose: purpose,
            term: term,
            date: new Date().toLocaleDateString('en-US'),
            status: 'pending', // 'pending', 'approved', 'rejected'
            paid: 0 // Amount paid back
        });
        saveState();
        updateLoansSection();
    };

    // --- Cashout Logic ---

    const calculateAnnualCashout = () => {
        if (!currentUser) return;
        
        const year = document.getElementById('cashoutYear').value;
        
        // Filter transactions for the selected year and current user (mocked for simplicity)
        const userTransactions = transactions.filter(t => t.userId === currentUser.email && new Date(t.date).getFullYear() == year && t.status === 'Confirmed');

        const totalSavings = userTransactions.filter(t => t.type === 'deposit').reduce((sum, t) => sum + t.amount, 0);
        const totalDeposits = totalSavings; // Simplified: all deposits count as savings/deposits
        const loanPayments = userTransactions.filter(t => t.type === 'loan_payment').reduce((sum, t) => sum + t.amount, 0);

        // Mock Calculation: 5% return on total savings/deposits
        const communityFundShare = (totalSavings + totalDeposits) * 0.05; 
        const totalDeductions = loanPayments; // Use loan payments as an example deduction

        const finalCashout = communityFundShare - totalDeductions;
        
        // Update the Cashout Section UI
        document.getElementById('totalSavingsAmount').textContent = formatCurrency(totalSavings);
        document.getElementById('totalDepositsAmount').textContent = formatCurrency(totalDeposits);
        document.getElementById('loanPaymentsAmount').textContent = formatCurrency(loanPayments);
        document.getElementById('communityFundShare').textContent = formatCurrency(communityFundShare);
        document.getElementById('totalDeductionsAmount').textContent = formatCurrency(totalDeductions);
        document.getElementById('finalCashoutAmount').textContent = formatCurrency(Math.max(0, finalCashout));
        
        // Store the calculated cashout value (useful for the request button)
        currentUser.calculatedCashout = Math.max(0, finalCashout);
        saveState();
    };

    const processCashoutRequest = () => {
        if (!currentUser) return;
        
        if (currentUser.calculatedCashout && currentUser.calculatedCashout > 0) {
            // In a real system, this would send a request to the backend for approval
            showNotification(`Cashout request for ${formatCurrency(currentUser.calculatedCashout)} submitted for approval.`, 'success');
        } else {
            showNotification('No cashout amount to request or calculation error.', 'error');
        }
    };
    
    // --- Chat Logic ---

    const loadChatMessages = () => {
        const chatBox = document.getElementById('chatBox');
        if (!chatBox) return;

        chatBox.innerHTML = '';
        chatMessages.forEach(msg => {
            const isSent = msg.userId === currentUser.email;
            const messageClass = isSent ? 'sent' : 'received';
            const senderName = isSent ? 'You' : getMemberNameById(msg.userId);

            chatBox.innerHTML += `
                <div class="message ${messageClass} fade-in">
                    <p class="font-bold text-sm mb-1">${senderName}</p>
                    <p>${msg.content}</p>
                    <p class="message-time text-right">${msg.time}</p>
                </div>
            
        });
        // Scroll to the bottom of the chat box
        chatBox.scrollTop = chatBox.scrollHeight;
    };

    const sendChatMessage = (event) => {
        event.preventDefault();
        const chatInput = document.getElementById('chatInput');
        const content = chatInput.value.trim();

        if (content === '') return;

        const newMessage = {
            id: Date.now().toString(),
            userId: currentUser.email,
            content: content,
            time: new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })
        };

        chatMessages.push(newMessage);
        saveState();
        loadChatMessages(); // Reload and scroll
        chatInput.value = ''; // Clear input

        // Mock a system response for a more interactive experience
        setTimeout(mockSystemResponse, 1500);
    };

    const mockSystemResponse = () => {
        const systemMessage = {
            id: Date.now().toString() + '_sys',
            userId: 'system@moneywise.com',
            content: "Thank you for your message. A community moderator will respond shortly.",
            time: new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })
        };

        chatMessages.push(systemMessage);
        saveState();
        loadChatMessages();
    };


    // --- Initialization and Mock Data ---
    
    const initializeApp = () => {
        // Ensure admin user exists
        if (!users.some(u => u.email === MOCK_ADMIN.email)) {
             users.push(MOCK_ADMIN);
             saveState();
        }
        
        // Add a mock member if none exist besides admin
        if (!users.some(u => u.email === 'member@example.com')) {
            users.push({
                id: Date.now() + 1,
                firstName: 'Jane',
                lastName: 'Doe',
                email: 'member@example.com',
                password: 'password123',
                is_admin: false,
                balance: 0,
                savings: 0,
                loans_due: 0,
                phoneNumber: '555-1234'
            });
            saveState();
        }

        // Mock some initial transactions for the member
        if (transactions.length === 0) {
            mockAddDeposit('member@example.com', 100, 'Initial Deposit');
            mockAddDeposit('member@example.com', 50, 'Monthly Savings');
            mockAddDeposit('member@example.com', 200, 'Bonus Payment');
            
            // Ensure some mock transactions are confirmed for cashout calculation
            transactions.forEach(t => t.status = 'Confirmed');
            
            // Add a mock loan
            mockAddLoan('member@example.com', 1000, 'Home Renovation', 12);
            // Approve the loan and set a paid amount
            const loan = loans.find(l => l.userId === 'member@example.com');
            if (loan) {
                loan.status = 'approved';
                loan.paid = 250;
                transactions.push({
                    id: Date.now() + 2,
                    userId: 'member@example.com',
                    type: 'loan_payment',
                    amount: 250,
                    description: 'First Loan Repayment',
                    date: new Date().toLocaleDateString('en-US'),
                    status: 'Confirmed'
                });
            }
            saveState();
        }

        // Show the correct initial view
        if (currentUser) {
            loginUser(currentUser);
        } else {
            showHomepage();
        }
    };
    
    // --- Language Selector Stub (for completeness) ---
    const translations = {
        en: { login: 'Login', signup: 'Sign Up' },
        ar: { login: 'تسجيل الدخول', signup: 'التسجيل' },
        sw: { login: 'Ingia', signup: 'Jisajili' },
        rw: { login: 'Injira', signup: 'Iyandikishe' }
    };

    const changeLanguage = () => {
        const lang = document.getElementById('languageSelector').value;
        document.querySelectorAll('[data-translate]').forEach(element => {
            const key = element.getAttribute('data-translate');
            element.textContent = translations[lang][key] || key;
        });
    };
    
    // --- PDF Report Functionality (Stub) ---
    const generatePdfReport = () => {
        showNotification('PDF Report generation initiated. (Requires jspdf library implementation)', 'success');
        // Actual jspdf implementation would go here, using window.jspdf.jsPDF
    };
    
    // Initialize the app on page load
    window.onload = initializeApp;

    // Expose functions globally for HTML calls
    window.showHomepage = showHomepage;
    window.showAuthSection = showAuthSection;
    window.showLogin = showLogin;
    window.showSignup = showSignup;
    window.handleLogin = handleLogin;
    window.handleSignup = handleSignup;
    window.logout = logout;
    window.showSection = showSection;
    window.toggleMobileMenu = toggleMobileMenu;
    window.loginAsAdmin = loginAsAdmin;
    window.createAdminAccount = createAdminAccount;
    window.showDepositModal = showDepositModal;
    window.showLoanModal = showLoanModal;
    window.calculateAnnualCashout = calculateAnnualCashout;
    window.processCashoutRequest = processCashoutRequest;
    window.sendChatMessage = sendChatMessage;
    window.approveDeposit = approveDeposit;
    window.deleteTransaction = deleteTransaction;
    window.changeLanguage = changeLanguage;
    window.generatePdfReport = generatePdfReport;

    // Mock Modal functions for Savings (not fully implemented in HTML provided)
    window.showAddSavingsModal = () => showNotification('Add Savings Goal modal opened. (Implementation required)', 'success');
  </script>
 </body>
</html>
            </form>
        </div>
    </div>
    <div id="notification" class="notification">
        </div>
    <script>
        // All JavaScript functions (showAuthSection, handleLogin, showSection, etc.)
        // will go here to control the view and application state.here
    </script>
    </body>
</html>
